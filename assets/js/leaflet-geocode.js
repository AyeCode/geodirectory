L.gdGeoCode={};L.gdGeoCode.Provider={};L.gdGeoCode.Result=function(e,t,s,o,n){this.X=e,this.Y=t,this.Label=s,this.bounds=o,n&&(this.details=n)};L.Control.gdGeoCode=L.Control.extend({options:{position:"topleft",showMarker:!0,showPopup:!1,customIcon:!1,retainZoomLevel:!1,draggable:!1},_config:{country:"",searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",messageHideDelay:3e3,zoomLevel:18},initialize:function(e){L.Util.extend(this.options,e),L.Util.extend(this._config,e)},resetLink:function(e){var t=this._container.querySelector("a");t.className="leaflet-bar-part leaflet-bar-part-single "+e},onAdd:function(e){this._container=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-geosearch");var t=L.DomUtil.create("a","",this._container);t.href="#",t.title=this._config.searchLabel,this.resetLink("glass");var s=L.DomUtil.create("form","displayNone",this._container),o=L.DomUtil.create("input",null,s);o.type="text",o.placeholder=this._config.searchLabel,this._searchbox=o;var n=L.DomUtil.create("div","leaflet-bar message displayNone",this._container);return this._msgbox=n,L.DomEvent.on(t,"click",L.DomEvent.stopPropagation).on(t,"click",L.DomEvent.preventDefault).on(t,"click",function(){L.DomUtil.hasClass(s,"displayNone")?(L.DomUtil.removeClass(s,"displayNone"),o.focus()):L.DomUtil.addClass(s,"displayNone")}).on(t,"dblclick",L.DomEvent.stopPropagation),L.DomEvent.addListener(this._searchbox,"keypress",this._onKeyPress,this).addListener(this._searchbox,"keyup",this._onKeyUp,this).addListener(this._searchbox,"input",this._onInput,this),L.DomEvent.disableClickPropagation(this._container),this._container},geosearch:function(e){var t=this;try{var s=this._config.provider;if(typeof s.GetLocations=="function")s.GetLocations(e,function(n){return t._processResults(n,e)});else{var o=s.GetServiceUrl(e);return this.sendRequest(s,o,e)}}catch(n){this._printError(n)}},cancelSearch:function(){var e=this._container.querySelector("form");L.DomUtil.addClass(e,"displayNone"),this._searchbox.value="",this.resetLink("glass"),L.DomUtil.addClass(this._msgbox,"displayNone"),this._map._container.focus()},startSearch:function(){this.resetLink("spinner"),this.geosearch(this._searchbox.value)},sendRequest:function(e,t,s){var o=this;window.parseLocation=function(a){var r=e.ParseJSON(a);return r=o._processResults(r,s),document.body.removeChild(document.getElementById("getJsonP")),delete window.parseLocation,r};function n(a){a=a+"&callback=parseLocation";var r=document.createElement("script");r.id="getJsonP",r.src=a,r.async=!0,document.body.appendChild(r)}if(XMLHttpRequest){var i=new XMLHttpRequest;if("withCredentials"in i){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState==4)if(i.status==200){var r=JSON.parse(i.responseText),h=e.ParseJSON(r);o._processResults(h,s)}else i.status==0||i.status==400?n(t):o._printError(i.responseText)},i.open("GET",t,!0),i.send()}else if(XDomainRequest){var l=new XDomainRequest;l.onerror=function(a){o._printError(a)},l.onload=function(){var a=JSON.parse(l.responseText),r=e.ParseJSON(a);o._processResults(r,s)},l.open("GET",t),l.send()}else n(t)}},_processResults:function(e,t){return e.length>0?e[0]:(this._printError(this._config.notFoundMessage),null)},_showLocation:function(e,t){this.options.showMarker==!0&&(typeof this._positionMarker>"u"?(this._positionMarker=L.marker([e.Y,e.X],{draggable:this.options.draggable}).addTo(this._map),this.options.customIcon&&this._positionMarker.setIcon(this.options.customIcon),this.options.showPopup&&this._positionMarker.bindPopup(t).openPopup()):(this._positionMarker.setLatLng([e.Y,e.X]),this.options.showPopup&&this._positionMarker.bindPopup(t).openPopup())),!this.options.retainZoomLevel&&e.bounds&&e.bounds.isValid()?this._map.fitBounds(e.bounds):this._map.setView([e.Y,e.X],this._getZoomLevel(),!1),this._map.fireEvent("geosearch_showlocation",{Location:e,Marker:this._positionMarker})},_isShowingError:!1,_printError:function(e){alert(e)},_onKeyUp:function(e){var t=27;e.keyCode===t&&this.cancelSearch()},_getZoomLevel:function(){return this.options.retainZoomLevel?this._map._zoom:this._config.zoomLevel},_onInput:function(){this._isShowingError&&(this.resetLink("glass"),L.DomUtil.addClass(this._msgbox,"displayNone"),this._isShowingError=!1)},_onKeyPress:function(e){var t=13;e.keyCode===t&&(e.preventDefault(),e.stopPropagation(),this.startSearch())}});L.gdGeoCode.Provider.OpenStreetMap=L.Class.extend({options:{},initialize:function(e){e=L.Util.setOptions(this,e)},GetServiceUrl:function(e){var t=L.Util.extend({q:e,format:"json"},this.options);return location.protocol==="https:","https:"+"//nominatim.openstreetmap.org/search"+L.Util.getParamString(t)},ParseJSON:function(e){for(var t=[],s=0;s<e.length;s++){var o=e[s].boundingbox,n=new L.LatLng(o[1],o[3]),i=new L.LatLng(o[0],o[2]);e[s].address&&(e[s].address.type=e[s].type),t.push(new L.gdGeoCode.Result(e[s].lon,e[s].lat,e[s].display_name,new L.LatLngBounds([n,i]),e[s].address))}return t}});
//# sourceMappingURL=leaflet-geocode.js.map
