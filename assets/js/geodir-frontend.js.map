{"version":3,"file":"geodir-frontend.js","sources":["../../resources/scripts/frontend/business-hours.js","../../resources/scripts/frontend.js"],"sourcesContent":["/**\n * Business Hours Frontend Display\n * Calculates and displays real-time open/closed status\n * Bootstrap handles all dropdown toggle functionality\n */\n\nclass BusinessHoursDisplay {\n\tconstructor() {\n\t\tthis.refreshAll();\n\t\tthis.refreshInterval = setInterval(() => this.refreshAll(), 60000);\n\t\tdocument.addEventListener('geodir_map_infowindow_open', () => setTimeout(() => this.refreshAll(), 50));\n\t\tdocument.addEventListener('geodir_content_updated', () => setTimeout(() => this.refreshAll(), 50));\n\t}\n\n\trefreshAll() {\n\t\tdocument.querySelectorAll('.gd-bh-show-field').forEach(field => this.refreshField(field));\n\t}\n\n\trefreshField(field) {\n\t\tconst expandRange = field.querySelector('.gd-bh-expand-range');\n\t\tif (!expandRange) return;\n\n\t\t// Calculate current time with timezone offset\n\t\tconst offsetSec = parseInt(expandRange.dataset.offsetsec || '0');\n\t\tconst d = new Date();\n\t\tconst localDate = new Date(d.getTime() + (d.getTimezoneOffset() * 60000) + (offsetSec * 1000));\n\n\t\tconst time = this.pad(localDate.getHours(), 2) + this.pad(localDate.getMinutes(), 2);\n\t\tlet day = localDate.getDay() || 7; // Convert Sunday (0) to 7\n\n\t\tfield.dataset.t = time;\n\t\texpandRange.dataset.date = localDate.toISOString().slice(0, 19);\n\n\t\tconst todayEl = field.querySelector(`[data-day=\"${day}\"]`);\n\t\tconst prevDay = day > 1 ? day - 1 : 7;\n\t\tconst prevEl = field.querySelector(`[data-day=\"${prevDay}\"]`);\n\n\t\tlet hasPrevOpen = false;\n\t\tlet times = [];\n\t\tlet opens = [];\n\n\t\t// Reset all classes\n\t\tfield.classList.remove('gd-bh-open', 'gd-bh-close');\n\t\tfield.querySelectorAll('div').forEach(div => {\n\t\t\tdiv.classList.remove('gd-bh-open', 'gd-bh-close', 'gd-bh-days-open', 'gd-bh-days-close',\n\t\t\t\t'gd-bh-slot-open', 'gd-bh-slot-close', 'gd-bh-days-today', 'gd-bh-days-prevday', 'active');\n\t\t});\n\n\t\t// Check previous day for next-day close scenarios\n\t\tif (prevEl?.querySelector('.gd-bh-next-day')) {\n\t\t\tprevEl.classList.add('gd-bh-days-prevday');\n\t\t\tconst prevDayName = prevEl.querySelector('.gd-bh-days-d')?.textContent || '';\n\n\t\t\tprevEl.querySelectorAll('.gd-bh-slot').forEach(slot => {\n\t\t\t\tconst isOpen = slot.dataset.open && slot.dataset.close && parseInt(time) <= parseInt(slot.dataset.close);\n\t\t\t\tconst slotRange = slot.querySelector('.gd-bh-slot-r')?.innerHTML || '';\n\n\t\t\t\tslot.classList.add(isOpen ? 'gd-bh-slot-open' : 'gd-bh-slot-close');\n\t\t\t\tif (isOpen) {\n\t\t\t\t\thasPrevOpen = true;\n\t\t\t\t\topens.push(prevDayName + ' ' + slotRange);\n\t\t\t\t}\n\t\t\t\ttimes.push(prevDayName + ' ' + slotRange);\n\t\t\t});\n\n\t\t\tprevEl.classList.add(hasPrevOpen ? 'gd-bh-days-open' : 'gd-bh-days-close');\n\t\t\tif (hasPrevOpen) times = opens;\n\n\t\t\tconst todayRange = field.querySelector('.gd-bh-today-range');\n\t\t\tif (todayRange) todayRange.innerHTML = times.join(', ');\n\t\t}\n\n\t\t// Process today's hours\n\t\tlet hasOpen = false;\n\t\tlet hasClosed = false;\n\n\t\tif (todayEl) {\n\t\t\ttodayEl.classList.add('gd-bh-days-today');\n\t\t\tconst dayName = todayEl.querySelector('.gd-bh-days-d')?.textContent || '';\n\t\t\tconst dayPrefix = hasPrevOpen ? (dayName ? dayName + ' ' : '') : '';\n\n\t\t\tif (!hasPrevOpen) {\n\t\t\t\ttimes = [];\n\t\t\t\topens = [];\n\t\t\t}\n\n\t\t\tif (todayEl.dataset.closed !== '1') {\n\t\t\t\ttodayEl.querySelectorAll('.gd-bh-slot').forEach(slot => {\n\t\t\t\t\tconst open = parseInt(slot.dataset.open);\n\t\t\t\t\tconst close = parseInt(slot.dataset.close);\n\t\t\t\t\tconst isNextDay = slot.classList.contains('gd-bh-next-day');\n\t\t\t\t\tconst slotRange = slot.querySelector('.gd-bh-slot-r')?.innerHTML || '';\n\t\t\t\t\tconst currentTime = parseInt(time);\n\t\t\t\t\tconst isOpen = open && close && open <= currentTime && (currentTime <= close || isNextDay);\n\n\t\t\t\t\tslot.classList.add(isOpen ? 'gd-bh-slot-open' : 'gd-bh-slot-close');\n\t\t\t\t\tif (isOpen) {\n\t\t\t\t\t\thasOpen = true;\n\t\t\t\t\t\topens.push(dayPrefix + slotRange);\n\t\t\t\t\t}\n\t\t\t\t\tif ((hasPrevOpen && hasOpen) || !hasPrevOpen) {\n\t\t\t\t\t\ttimes.push(dayPrefix + slotRange);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\thasClosed = true;\n\t\t\t}\n\n\t\t\ttodayEl.classList.add(hasOpen ? 'gd-bh-days-open' : 'gd-bh-days-close');\n\t\t\tif (hasOpen) times = opens;\n\n\t\t\tconst todayRange = field.querySelector('.gd-bh-today-range');\n\t\t\tif (todayRange) todayRange.innerHTML = [...new Set(times)].join(', ');\n\t\t}\n\n\t\t// Update status label and colors\n\t\tconst params = window.geodir_params || {};\n\t\tconst isOpen = hasOpen || hasPrevOpen;\n\t\tconst label = isOpen ? (params.txt_open_now || 'Open now')\n\t\t\t: (hasClosed ? (params.txt_closed_today || 'Closed today') : (params.txt_closed_now || 'Closed now'));\n\n\t\tfield.classList.add(isOpen ? 'gd-bh-open' : 'gd-bh-close');\n\n\t\tconst iconEl = field.querySelector('.geodir-i-biz-hours');\n\t\tconst labelEl = field.querySelector('.geodir-i-biz-hours font');\n\t\tconst colorClass = isOpen ? 'text-success' : 'text-danger';\n\t\tconst removeClass = isOpen ? 'text-danger' : 'text-success';\n\n\t\tif (iconEl) {\n\t\t\ticonEl.classList.add(colorClass);\n\t\t\ticonEl.classList.remove(removeClass);\n\t\t}\n\t\tif (labelEl) labelEl.textContent = label;\n\n\t\t// Color slot times in dropdown\n\t\tfield.querySelectorAll('.gd-bh-slot-open .gd-bh-slot-r').forEach(el => {\n\t\t\tel.classList.add('text-success');\n\t\t\tel.classList.remove('text-danger');\n\t\t});\n\t\tfield.querySelectorAll('.gd-bh-slot-close .gd-bh-slot-r').forEach(el => {\n\t\t\tel.classList.add('text-danger');\n\t\t\tel.classList.remove('text-success');\n\t\t});\n\n\t\t// Add background color to today's row based on open/closed status\n\t\tif (todayEl?.classList.contains('gd-bh-days-list')) {\n\t\t\tconst bgClass = isOpen ? 'bg-success-subtle' : 'bg-danger-subtle';\n\t\t\tconst removeBgClass = isOpen ? 'bg-danger-subtle' : 'bg-success-subtle';\n\t\t\ttodayEl.classList.add(bgClass);\n\t\t\ttodayEl.classList.remove(removeBgClass);\n\t\t}\n\n\t\t// Add background to previous day if showing next-day close\n\t\tif (hasPrevOpen && prevEl?.classList.contains('gd-bh-days-list')) {\n\t\t\tprevEl.classList.add('bg-success-subtle');\n\t\t\tprevEl.classList.remove('bg-danger-subtle');\n\t\t}\n\t}\n\n\tpad(num, size) {\n\t\treturn String(num).padStart(size, '0');\n\t}\n\n\tdestroy() {\n\t\tclearInterval(this.refreshInterval);\n\t}\n}\n\nexport function initBusinessHoursDisplay() {\n\treturn document.querySelector('.gd-bh-show-field') ? new BusinessHoursDisplay() : null;\n}\n","/**\n * GeoDirectory Frontend Script\n * Handles frontend interactions.\n * Relies on window.Alpine being available (loaded via Composer package).\n */\n\nimport { initBusinessHoursDisplay } from './frontend/business-hours.js';\n\n// Initialize GeoDir namespace\nwindow.GeoDir = window.GeoDir || {};\n\n// Wait for Alpine to initialize\ndocument.addEventListener('alpine:init', () => {\n\tconsole.log('GeoDirectory: Alpine initialized');\n\n\t// Example: Register a global Alpine data object or store here if needed\n\t// Alpine.data('geoDirSearch', () => ({ ... }));\n});\n\n// Standard DOM Ready for non-Alpine logic\ndocument.addEventListener('DOMContentLoaded', () => {\n\tconsole.log('GeoDirectory: Frontend DOM loaded');\n\n\t// Initialize business hours display\n\tconst bhDisplay = initBusinessHoursDisplay();\n\tif (bhDisplay) {\n\t\twindow.GeoDir.businessHoursDisplay = bhDisplay;\n\t\tconsole.log('GeoDirectory: Business hours display initialized');\n\t}\n});\n"],"names":["BusinessHoursDisplay","field","expandRange","offsetSec","d","localDate","time","day","todayEl","prevDay","prevEl","hasPrevOpen","times","opens","div","prevDayName","slot","isOpen","slotRange","todayRange","hasOpen","hasClosed","dayName","dayPrefix","open","close","isNextDay","currentTime","params","label","iconEl","labelEl","colorClass","removeClass","el","bgClass","removeBgClass","num","size","initBusinessHoursDisplay","bhDisplay"],"mappings":"AAMA,MAAMA,CAAqB,CAC1B,aAAc,CACb,KAAK,WAAU,EACf,KAAK,gBAAkB,YAAY,IAAM,KAAK,WAAU,EAAI,GAAK,EACjE,SAAS,iBAAiB,6BAA8B,IAAM,WAAW,IAAM,KAAK,aAAc,EAAE,CAAC,EACrG,SAAS,iBAAiB,yBAA0B,IAAM,WAAW,IAAM,KAAK,aAAc,EAAE,CAAC,CAClG,CAEA,YAAa,CACZ,SAAS,iBAAiB,mBAAmB,EAAE,QAAQC,GAAS,KAAK,aAAaA,CAAK,CAAC,CACzF,CAEA,aAAaA,EAAO,CACnB,MAAMC,EAAcD,EAAM,cAAc,qBAAqB,EAC7D,GAAI,CAACC,EAAa,OAGlB,MAAMC,EAAY,SAASD,EAAY,QAAQ,WAAa,GAAG,EACzDE,EAAI,IAAI,KACRC,EAAY,IAAI,KAAKD,EAAE,QAAO,EAAMA,EAAE,kBAAiB,EAAK,IAAUD,EAAY,GAAK,EAEvFG,EAAO,KAAK,IAAID,EAAU,SAAQ,EAAI,CAAC,EAAI,KAAK,IAAIA,EAAU,WAAU,EAAI,CAAC,EACnF,IAAIE,EAAMF,EAAU,OAAM,GAAM,EAEhCJ,EAAM,QAAQ,EAAIK,EAClBJ,EAAY,QAAQ,KAAOG,EAAU,YAAW,EAAG,MAAM,EAAG,EAAE,EAE9D,MAAMG,EAAUP,EAAM,cAAc,cAAcM,CAAG,IAAI,EACnDE,EAAUF,EAAM,EAAIA,EAAM,EAAI,EAC9BG,EAAST,EAAM,cAAc,cAAcQ,CAAO,IAAI,EAE5D,IAAIE,EAAc,GACdC,EAAQ,CAAA,EACRC,EAAQ,CAAA,EAUZ,GAPAZ,EAAM,UAAU,OAAO,aAAc,aAAa,EAClDA,EAAM,iBAAiB,KAAK,EAAE,QAAQa,GAAO,CAC5CA,EAAI,UAAU,OAAO,aAAc,cAAe,kBAAmB,mBACpE,kBAAmB,mBAAoB,mBAAoB,qBAAsB,QAAQ,CAC3F,CAAC,EAGGJ,GAAQ,cAAc,iBAAiB,EAAG,CAC7CA,EAAO,UAAU,IAAI,oBAAoB,EACzC,MAAMK,EAAcL,EAAO,cAAc,eAAe,GAAG,aAAe,GAE1EA,EAAO,iBAAiB,aAAa,EAAE,QAAQM,GAAQ,CACtD,MAAMC,EAASD,EAAK,QAAQ,MAAQA,EAAK,QAAQ,OAAS,SAASV,CAAI,GAAK,SAASU,EAAK,QAAQ,KAAK,EACjGE,EAAYF,EAAK,cAAc,eAAe,GAAG,WAAa,GAEpEA,EAAK,UAAU,IAAIC,EAAS,kBAAoB,kBAAkB,EAC9DA,IACHN,EAAc,GACdE,EAAM,KAAKE,EAAc,IAAMG,CAAS,GAEzCN,EAAM,KAAKG,EAAc,IAAMG,CAAS,CACzC,CAAC,EAEDR,EAAO,UAAU,IAAIC,EAAc,kBAAoB,kBAAkB,EACrEA,IAAaC,EAAQC,GAEzB,MAAMM,EAAalB,EAAM,cAAc,oBAAoB,EACvDkB,IAAYA,EAAW,UAAYP,EAAM,KAAK,IAAI,EACvD,CAGA,IAAIQ,EAAU,GACVC,EAAY,GAEhB,GAAIb,EAAS,CACZA,EAAQ,UAAU,IAAI,kBAAkB,EACxC,MAAMc,EAAUd,EAAQ,cAAc,eAAe,GAAG,aAAe,GACjEe,EAAYZ,GAAeW,EAAUA,EAAU,IAAY,GAE5DX,IACJC,EAAQ,CAAA,EACRC,EAAQ,CAAA,GAGLL,EAAQ,QAAQ,SAAW,IAC9BA,EAAQ,iBAAiB,aAAa,EAAE,QAAQQ,GAAQ,CACvD,MAAMQ,EAAO,SAASR,EAAK,QAAQ,IAAI,EACjCS,EAAQ,SAAST,EAAK,QAAQ,KAAK,EACnCU,EAAYV,EAAK,UAAU,SAAS,gBAAgB,EACpDE,EAAYF,EAAK,cAAc,eAAe,GAAG,WAAa,GAC9DW,EAAc,SAASrB,CAAI,EAC3BW,EAASO,GAAQC,GAASD,GAAQG,IAAgBA,GAAeF,GAASC,GAEhFV,EAAK,UAAU,IAAIC,EAAS,kBAAoB,kBAAkB,EAC9DA,IACHG,EAAU,GACVP,EAAM,KAAKU,EAAYL,CAAS,IAE5BP,GAAeS,GAAY,CAACT,IAChCC,EAAM,KAAKW,EAAYL,CAAS,CAElC,CAAC,EAEDG,EAAY,GAGbb,EAAQ,UAAU,IAAIY,EAAU,kBAAoB,kBAAkB,EAClEA,IAASR,EAAQC,GAErB,MAAMM,EAAalB,EAAM,cAAc,oBAAoB,EACvDkB,IAAYA,EAAW,UAAY,CAAC,GAAG,IAAI,IAAIP,CAAK,CAAC,EAAE,KAAK,IAAI,EACrE,CAGA,MAAMgB,EAAS,OAAO,eAAiB,CAAA,EACjCX,EAASG,GAAWT,EACpBkB,EAAQZ,EAAUW,EAAO,cAAgB,WAC3CP,EAAaO,EAAO,kBAAoB,eAAmBA,EAAO,gBAAkB,aAExF3B,EAAM,UAAU,IAAIgB,EAAS,aAAe,aAAa,EAEzD,MAAMa,EAAS7B,EAAM,cAAc,qBAAqB,EAClD8B,EAAU9B,EAAM,cAAc,0BAA0B,EACxD+B,EAAaf,EAAS,eAAiB,cACvCgB,EAAchB,EAAS,cAAgB,eAmB7C,GAjBIa,IACHA,EAAO,UAAU,IAAIE,CAAU,EAC/BF,EAAO,UAAU,OAAOG,CAAW,GAEhCF,IAASA,EAAQ,YAAcF,GAGnC5B,EAAM,iBAAiB,gCAAgC,EAAE,QAAQiC,GAAM,CACtEA,EAAG,UAAU,IAAI,cAAc,EAC/BA,EAAG,UAAU,OAAO,aAAa,CAClC,CAAC,EACDjC,EAAM,iBAAiB,iCAAiC,EAAE,QAAQiC,GAAM,CACvEA,EAAG,UAAU,IAAI,aAAa,EAC9BA,EAAG,UAAU,OAAO,cAAc,CACnC,CAAC,EAGG1B,GAAS,UAAU,SAAS,iBAAiB,EAAG,CACnD,MAAM2B,EAAUlB,EAAS,oBAAsB,mBACzCmB,EAAgBnB,EAAS,mBAAqB,oBACpDT,EAAQ,UAAU,IAAI2B,CAAO,EAC7B3B,EAAQ,UAAU,OAAO4B,CAAa,CACvC,CAGIzB,GAAeD,GAAQ,UAAU,SAAS,iBAAiB,IAC9DA,EAAO,UAAU,IAAI,mBAAmB,EACxCA,EAAO,UAAU,OAAO,kBAAkB,EAE5C,CAEA,IAAI2B,EAAKC,EAAM,CACd,OAAO,OAAOD,CAAG,EAAE,SAASC,EAAM,GAAG,CACtC,CAEA,SAAU,CACT,cAAc,KAAK,eAAe,CACnC,CACD,CAEO,SAASC,GAA2B,CAC1C,OAAO,SAAS,cAAc,mBAAmB,EAAI,IAAIvC,EAAyB,IACnF,CCjKA,OAAO,OAAS,OAAO,QAAU,CAAA,EAGjC,SAAS,iBAAiB,cAAe,IAAM,CAC9C,QAAQ,IAAI,kCAAkC,CAI/C,CAAC,EAGD,SAAS,iBAAiB,mBAAoB,IAAM,CACnD,QAAQ,IAAI,mCAAmC,EAG/C,MAAMwC,EAAYD,EAAwB,EACtCC,IACH,OAAO,OAAO,qBAAuBA,EACrC,QAAQ,IAAI,kDAAkD,EAEhE,CAAC"}