(function(){(function(){var k={}.hasOwnProperty,y=[].slice;this.L!=null&&(this.OverlappingMarkerSpiderfier=(function(){function c(e,t){var r,i,n,s,h=this;this.map=e,t==null&&(t={});for(r in t)k.call(t,r)&&(i=t[r],this[r]=i);for(this.initMarkerArrays(),this.listeners={},s=["click","zoomend"],i=0,n=s.length;i<n;i++)r=s[i],this.map.addEventListener(r,function(){return h.unspiderfy()})}var a,f;return a=c.prototype,a.VERSION="0.2.6",f=2*Math.PI,a.keepSpiderfied=!1,a.nearbyDistance=20,a.circleSpiralSwitchover=9,a.circleFootSeparation=25,a.circleStartAngle=f/12,a.spiralFootSeparation=28,a.spiralLengthStart=11,a.spiralLengthFactor=5,a.legWeight=1.5,a.legColors={usual:"#222",highlighted:"#f00"},a.initMarkerArrays=function(){return this.markers=[],this.markerListeners=[]},a.addMarker=function(e){var t,r=this;return e._oms!=null?this:(e._oms=!0,t=function(){return r.spiderListener(e)},e.addEventListener("click",t),this.markerListeners.push(t),this.markers.push(e),this)},a.getMarkers=function(){return this.markers.slice(0)},a.removeMarker=function(e){var t,r;return e._omsData!=null&&this.unspiderfy(),t=this.arrIndexOf(this.markers,e),0>t?this:(r=this.markerListeners.splice(t,1)[0],e.removeEventListener("click",r),delete e._oms,this.markers.splice(t,1),this)},a.clearMarkers=function(){var e,t,r,i,n;for(this.unspiderfy(),n=this.markers,e=r=0,i=n.length;r<i;e=++r)t=n[e],e=this.markerListeners[e],t.removeEventListener("click",e),delete t._oms;return this.initMarkerArrays(),this},a.addListener=function(e,t){var r,i;return((i=(r=this.listeners)[e])!=null?i:r[e]=[]).push(t),this},a.removeListener=function(e,t){var r;return r=this.arrIndexOf(this.listeners[e],t),0>r||this.listeners[e].splice(r,1),this},a.clearListeners=function(e){return this.listeners[e]=[],this},a.trigger=function(){var e,t,r,i,n,s;for(t=arguments[0],e=2<=arguments.length?y.call(arguments,1):[],t=(r=this.listeners[t])!=null?r:[],s=[],i=0,n=t.length;i<n;i++)r=t[i],s.push(r.apply(null,e));return s},a.generatePtsCircle=function(e,t){var r,i,n,s,h;for(n=this.circleFootSeparation*(2+e)/f,i=f/e,h=[],r=s=0;0<=e?s<e:s>e;r=0<=e?++s:--s)r=this.circleStartAngle+r*i,h.push(new L.Point(t.x+n*Math.cos(r),t.y+n*Math.sin(r)));return h},a.generatePtsSpiral=function(e,t){var r,i,n,s,h;for(n=this.spiralLengthStart,r=0,h=[],i=s=0;0<=e?s<e:s>e;i=0<=e?++s:--s)r+=this.spiralFootSeparation/n+5e-4*i,i=new L.Point(t.x+n*Math.cos(r),t.y+n*Math.sin(r)),n+=f*this.spiralLengthFactor/r,h.push(i);return h},a.spiderListener=function(e){var t,r,i,n,s,h,l,p,u;if((t=e._omsData!=null)&&this.keepSpiderfied||this.unspiderfy(),t)return this.trigger("click",e);for(n=[],s=[],h=this.nearbyDistance*this.nearbyDistance,i=this.map.latLngToLayerPoint(e.getLatLng()),u=this.markers,l=0,p=u.length;l<p;l++)t=u[l],this.map.hasLayer(t)&&(r=this.map.latLngToLayerPoint(t.getLatLng()),this.ptDistanceSq(r,i)<h?n.push({marker:t,markerPt:r}):s.push(t));return n.length===1?this.trigger("click",e):this.spiderfy(n,s)},a.makeHighlightListeners=function(e){var t=this;return{highlight:function(){return e._omsData.leg.setStyle({color:t.legColors.highlighted})},unhighlight:function(){return e._omsData.leg.setStyle({color:t.legColors.usual})}}},a.spiderfy=function(e,t){var r,i,n,s,h,l,p,u,v,m;return this.spiderfying=!0,m=e.length,r=this.ptAverage((function(){var o,d,g;for(g=[],o=0,d=e.length;o<d;o++)p=e[o],g.push(p.markerPt);return g})()),s=m>=this.circleSpiralSwitchover?this.generatePtsSpiral(m,r).reverse():this.generatePtsCircle(m,r),r=(function(){var o,d,g,S=this;for(g=[],o=0,d=s.length;o<d;o++)n=s[o],i=this.map.layerPointToLatLng(n),v=this.minExtract(e,function(P){return S.ptDistanceSq(P.markerPt,n)}),l=v.marker,h=new L.Polyline([l.getLatLng(),i],{color:this.legColors.usual,weight:this.legWeight,clickable:!1}),this.map.addLayer(h),l._omsData={usualPosition:l.getLatLng(),leg:h},this.legColors.highlighted!==this.legColors.usual&&(u=this.makeHighlightListeners(l),l._omsData.highlightListeners=u,l.addEventListener("mouseover",u.highlight),l.addEventListener("mouseout",u.unhighlight)),l.setLatLng(i),l.setZIndexOffset(1e6),g.push(l);return g}).call(this),delete this.spiderfying,this.spiderfied=!0,this.trigger("spiderfy",r,t)},a.unspiderfy=function(e){var t,r,i,n,s,h,l;if(e==null&&(e=null),this.spiderfied==null)return this;for(this.unspiderfying=!0,n=[],i=[],l=this.markers,s=0,h=l.length;s<h;s++)t=l[s],t._omsData!=null?(this.map.removeLayer(t._omsData.leg),t!==e&&t.setLatLng(t._omsData.usualPosition),t.setZIndexOffset(0),r=t._omsData.highlightListeners,r!=null&&(t.removeEventListener("mouseover",r.highlight),t.removeEventListener("mouseout",r.unhighlight)),delete t._omsData,n.push(t)):i.push(t);return delete this.unspiderfying,delete this.spiderfied,this.trigger("unspiderfy",n,i),this},a.ptDistanceSq=function(e,t){var r,i;return r=e.x-t.x,i=e.y-t.y,r*r+i*i},a.ptAverage=function(e){var t,r,i,n,s;for(n=r=i=0,s=e.length;n<s;n++)t=e[n],r+=t.x,i+=t.y;return e=e.length,new L.Point(r/e,i/e)},a.minExtract=function(e,t){var r,i,n,s,h,l;for(n=h=0,l=e.length;h<l;n=++h)s=e[n],s=t(s),(typeof r>"u"||r===null||s<i)&&(i=s,r=n);return e.splice(r,1)[0]},a.arrIndexOf=function(e,t){var r,i,n,s;if(e.indexOf!=null)return e.indexOf(t);for(r=n=0,s=e.length;n<s;r=++n)if(i=e[r],i===t)return r;return-1},c})())}).call(this)}).call(void 0);
//# sourceMappingURL=oms-leaflet.js.map
