(function(){class R{constructor(){this.refreshAll(),this.refreshInterval=setInterval(()=>this.refreshAll(),6e4),document.addEventListener("geodir_map_infowindow_open",()=>setTimeout(()=>this.refreshAll(),50)),document.addEventListener("geodir_content_updated",()=>setTimeout(()=>this.refreshAll(),50))}refreshAll(){document.querySelectorAll(".gd-bh-show-field").forEach(e=>this.refreshField(e))}refreshField(e){const o=e.querySelector(".gd-bh-expand-range");if(!o)return;const g=parseInt(o.dataset.offsetsec||"0"),t=new Date,a=new Date(t.getTime()+t.getTimezoneOffset()*6e4+g*1e3),i=this.pad(a.getHours(),2)+this.pad(a.getMinutes(),2);let h=a.getDay()||7;e.dataset.t=i,o.dataset.date=a.toISOString().slice(0,19);const l=e.querySelector(`[data-day="${h}"]`),v=h>1?h-1:7,n=e.querySelector(`[data-day="${v}"]`);let s=!1,c=[],y=[];if(e.classList.remove("gd-bh-open","gd-bh-close"),e.querySelectorAll("div").forEach(d=>{d.classList.remove("gd-bh-open","gd-bh-close","gd-bh-days-open","gd-bh-days-close","gd-bh-slot-open","gd-bh-slot-close","gd-bh-days-today","gd-bh-days-prevday","active")}),n?.querySelector(".gd-bh-next-day")){n.classList.add("gd-bh-days-prevday");const d=n.querySelector(".gd-bh-days-d")?.textContent||"";n.querySelectorAll(".gd-bh-slot").forEach(b=>{const f=b.dataset.open&&b.dataset.close&&parseInt(i)<=parseInt(b.dataset.close),S=b.querySelector(".gd-bh-slot-r")?.innerHTML||"";b.classList.add(f?"gd-bh-slot-open":"gd-bh-slot-close"),f&&(s=!0,y.push(d+" "+S)),c.push(d+" "+S)}),n.classList.add(s?"gd-bh-days-open":"gd-bh-days-close"),s&&(c=y);const w=e.querySelector(".gd-bh-today-range");w&&(w.innerHTML=c.join(", "))}let p=!1,u=!1;if(l){l.classList.add("gd-bh-days-today");const d=l.querySelector(".gd-bh-days-d")?.textContent||"",w=s&&d?d+" ":"";s||(c=[],y=[]),l.dataset.closed!=="1"?l.querySelectorAll(".gd-bh-slot").forEach(f=>{const S=parseInt(f.dataset.open),D=parseInt(f.dataset.close),O=f.classList.contains("gd-bh-next-day"),E=f.querySelector(".gd-bh-slot-r")?.innerHTML||"",A=parseInt(i),C=S&&D&&S<=A&&(A<=D||O);f.classList.add(C?"gd-bh-slot-open":"gd-bh-slot-close"),C&&(p=!0,y.push(w+E)),(s&&p||!s)&&c.push(w+E)}):u=!0,l.classList.add(p?"gd-bh-days-open":"gd-bh-days-close"),p&&(c=y);const b=e.querySelector(".gd-bh-today-range");b&&(b.innerHTML=[...new Set(c)].join(", "))}const m=window.geodir_params||{},L=p||s,_=L?m.txt_open_now||"Open now":u?m.txt_closed_today||"Closed today":m.txt_closed_now||"Closed now";e.classList.add(L?"gd-bh-open":"gd-bh-close");const x=e.querySelector(".geodir-i-biz-hours"),q=e.querySelector(".geodir-i-biz-hours font"),I=L?"text-success":"text-danger",M=L?"text-danger":"text-success";if(x&&(x.classList.add(I),x.classList.remove(M)),q&&(q.textContent=_),e.querySelectorAll(".gd-bh-slot-open .gd-bh-slot-r").forEach(d=>{d.classList.add("text-success"),d.classList.remove("text-danger")}),e.querySelectorAll(".gd-bh-slot-close .gd-bh-slot-r").forEach(d=>{d.classList.add("text-danger"),d.classList.remove("text-success")}),l?.classList.contains("gd-bh-days-list")){const d=L?"bg-success-subtle":"bg-danger-subtle",w=L?"bg-danger-subtle":"bg-success-subtle";l.classList.add(d),l.classList.remove(w)}s&&n?.classList.contains("gd-bh-days-list")&&(n.classList.add("bg-success-subtle"),n.classList.remove("bg-danger-subtle"))}pad(e,o){return String(e).padStart(o,"0")}destroy(){clearInterval(this.refreshInterval)}}function $(){return document.querySelector(".gd-bh-show-field")?new R:null}function T(){const r=document.querySelectorAll(".gd-rating-input");r.length&&r.forEach(e=>{const o=e.querySelector(".gd-rating-wrap"),g=e.querySelector(".gd-rating-foreground"),t=e.querySelector(".gd-rating-text"),a=e.querySelector('input[type="hidden"]'),i=e.querySelectorAll(".gd-rating-foreground > i, .gd-rating-foreground > svg, .gd-rating-foreground > img");if(!o||!g||!t||!a||!i.length)return;const h=i.length,l=parseFloat(a.value)||0;if(g.style.pointerEvents="none",l>0){const n=l/h*100;g.style.width=`${n}%`;const s=Math.floor(l)-1;i[s]&&(t.textContent=i[s].getAttribute("title")||"")}let v=!1;o.addEventListener("mousemove",n=>{const s=o.getBoundingClientRect(),c=n.clientX-s.left,y=s.width/h,p=Math.floor(c/y),u=Math.min(Math.max(p+1,1),h),m=u/h*100;g.style.width=`${m}%`,i[u-1]&&(t.textContent=i[u-1].getAttribute("title")||""),v=!1}),o.addEventListener("mouseleave",()=>{if(!v){const n=parseFloat(a.value)||0,s=n/h*100;if(g.style.width=`${s}%`,n>0){const c=Math.floor(n)-1;i[c]&&(t.textContent=i[c].getAttribute("title")||"")}else t.textContent=t.getAttribute("data-title")||""}v=!1}),o.addEventListener("click",n=>{const s=o.getBoundingClientRect(),c=n.clientX-s.left,y=s.width/h,p=Math.floor(c/y),u=Math.min(Math.max(p+1,1),h),m=u/h*100;a.value=u,g.style.width=`${m}%`,i[u-1]&&(t.textContent=i[u-1].getAttribute("title")||""),v=!0})})}window.GeoDir=window.GeoDir||{};window.GeoDir.api={baseURL:window.geodir_params?.rest_url||"/wp-json/geodir/v3",nonce:window.geodir_params?.rest_nonce||"",async request(r,e={}){const o=`${this.baseURL}/${r}`,g={"X-WP-Nonce":this.nonce,"Content-Type":"application/json",...e.headers};try{const t=await fetch(o,{...e,headers:g}),a=await t.json();if(!t.ok)throw new Error(a.message||`HTTP ${t.status}: ${t.statusText}`);return a}catch(t){throw console.error("GeoDir API Error:",t),t}},async post(r,e){return this.request(r,{method:"POST",body:JSON.stringify(e)})},async put(r,e){return this.request(r,{method:"PUT",body:JSON.stringify(e)})},async delete(r){return this.request(r,{method:"DELETE"})},async uploadFile(r,e=0){const o=new FormData;o.append("file",r),e&&o.append("post_id",e);const g=`${this.baseURL}/media/upload`,t=await fetch(g,{method:"POST",headers:{"X-WP-Nonce":this.nonce},body:o}),a=await t.json();if(!t.ok)throw new Error(a.message||"Upload failed");return a}};document.addEventListener("alpine:init",()=>{console.log("GeoDirectory: Alpine initialized")});document.addEventListener("DOMContentLoaded",()=>{console.log("GeoDirectory: Frontend DOM loaded");const r=$();r&&(window.GeoDir.businessHoursDisplay=r,console.log("GeoDirectory: Business hours display initialized")),T(),window.GeoDir.initRatingInput=T,console.log("GeoDirectory: Rating input initialized")});
//# sourceMappingURL=geodir-frontend.js.map
})();