{"version":3,"file":"geodir-add-listing.js","sources":["../../resources/scripts/add-listing/validation.js","../../resources/scripts/add-listing/utils.js","../../resources/scripts/add-listing/auto-save.js","../../resources/scripts/add-listing/form-submit.js","../../resources/scripts/add-listing/category-manager.js","../../resources/scripts/add-listing/business-hours.js","../../resources/scripts/add-listing/index.js"],"sourcesContent":["/**\n * Form validation functions for add-listing form\n * Uses Bootstrap 5.3+ validation classes\n */\n\n/**\n * Validate a single field based on its field_type attribute\n * @param {HTMLElement} field - The field element to validate\n * @returns {boolean} - True if valid, false if invalid\n */\nexport function validateField(field) {\n\tconst fieldType = field.getAttribute('field_type');\n\tlet isValid = true;\n\tlet errorMessage = window.geodir_params?.field_id_required || 'This field is required.';\n\n\t// Get the required field wrapper\n\tconst requiredFieldWrap = field.closest('.required_field');\n\tif (!requiredFieldWrap) {\n\t\treturn true; // Not a required field\n\t}\n\n\tswitch (fieldType) {\n\t\tcase 'radio':\n\t\tcase 'checkbox':\n\t\t\t// Check if at least one is checked\n\t\t\tconst checkedInputs = requiredFieldWrap.querySelectorAll(':checked');\n\t\t\tisValid = checkedInputs.length > 0;\n\n\t\t\t// Check category limit if exists\n\t\t\tconst catLimitInput = requiredFieldWrap.querySelector('#cat_limit');\n\t\t\tif (catLimitInput) {\n\t\t\t\tconst catLimit = parseInt(catLimitInput.getAttribute('cat_limit'));\n\t\t\t\tconst catMsg = catLimitInput.value;\n\t\t\t\tif (checkedInputs.length > catLimit && catLimit > 0) {\n\t\t\t\t\tisValid = false;\n\t\t\t\t\terrorMessage = catMsg;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'select':\n\t\t\t// Check if taxonomy field (post_category)\n\t\t\tif (requiredFieldWrap.querySelector('.geodir_taxonomy_field') &&\n\t\t\t    requiredFieldWrap.querySelector('#post_category')) {\n\t\t\t\tconst postCategory = requiredFieldWrap.querySelector('#post_category');\n\t\t\t\tisValid = postCategory.value !== '';\n\t\t\t} else {\n\t\t\t\tconst selectedOption = field.querySelector('option:selected');\n\t\t\t\tisValid = selectedOption && selectedOption.value !== '';\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'multiselect':\n\t\t\t// Check category limit\n\t\t\tconst multiCatLimit = requiredFieldWrap.querySelector('#cat_limit');\n\t\t\tif (multiCatLimit) {\n\t\t\t\tconst limit = parseInt(multiCatLimit.getAttribute('cat_limit'));\n\t\t\t\tconst msg = multiCatLimit.value;\n\t\t\t\tconst selectedOptions = field.querySelectorAll('option:selected');\n\t\t\t\tif (selectedOptions.length > limit && limit > 0) {\n\t\t\t\t\tisValid = false;\n\t\t\t\t\terrorMessage = msg;\n\t\t\t\t} else {\n\t\t\t\t\tisValid = selectedOptions.length > 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst selectedOptions = field.querySelectorAll('option:selected');\n\t\t\t\tisValid = selectedOptions.length > 0;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'email':\n\t\t\tconst emailRegex = /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n\t\t\tisValid = field.value !== '' && emailRegex.test(field.value);\n\t\t\tbreak;\n\n\t\tcase 'url':\n\t\t\tconst urlRegex = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/;\n\t\t\tisValid = field.value !== '' && urlRegex.test(field.value);\n\t\t\tbreak;\n\n\t\tcase 'editor':\n\t\t\tconst fieldId = field.getAttribute('field_id');\n\t\t\tconst editorField = document.getElementById(fieldId);\n\t\t\tisValid = editorField && editorField.value !== '';\n\t\t\tbreak;\n\n\t\tcase 'address':\n\t\t\t// Special validation for latitude/longitude\n\t\t\tif (field.id === 'post_latitude' || field.id === 'post_longitude') {\n\t\t\t\tconst coordRegex = /^[0-90\\-.]*$/;\n\t\t\t\tif (coordRegex.test(field.value) && field.value !== '') {\n\t\t\t\t\tisValid = true;\n\t\t\t\t} else {\n\t\t\t\t\tisValid = false;\n\t\t\t\t\terrorMessage = field.id === 'post_latitude'\n\t\t\t\t\t\t? (window.geodir_params?.latitude_error_msg || 'Please enter a valid latitude.')\n\t\t\t\t\t\t: (window.geodir_params?.longgitude_error_msg || 'Please enter a valid longitude.');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tisValid = field.value.trim() !== '';\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'datepicker':\n\t\tcase 'time':\n\t\tcase 'text':\n\t\tcase 'hidden': // images\n\t\tcase 'textarea':\n\t\t\tisValid = field.value.trim() !== '';\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tisValid = field.value.trim() !== '';\n\t\t\tbreak;\n\t}\n\n\t// Update UI based on validation result\n\tupdateFieldValidationUI(requiredFieldWrap, field, isValid, errorMessage);\n\n\treturn isValid;\n}\n\n/**\n * Update field validation UI with Bootstrap classes\n * @param {HTMLElement} requiredFieldWrap\n * @param {HTMLElement} field\n * @param {boolean} isValid\n * @param {string} errorMessage\n */\nfunction updateFieldValidationUI(requiredFieldWrap, field, isValid, errorMessage) {\n\tconst errorElement = requiredFieldWrap.querySelector('.geodir_message_error');\n\n\tif (isValid) {\n\t\t// Remove invalid state\n\t\tfield.classList.remove('is-invalid');\n\t\tfield.classList.add('is-valid');\n\n\t\tif (errorElement) {\n\t\t\terrorElement.textContent = '';\n\t\t\terrorElement.style.display = 'none';\n\t\t}\n\t} else {\n\t\t// Add invalid state\n\t\tfield.classList.remove('is-valid');\n\t\tfield.classList.add('is-invalid');\n\n\t\tif (errorElement) {\n\t\t\tif (errorElement.textContent === '') {\n\t\t\t\terrorElement.textContent = errorMessage;\n\t\t\t}\n\t\t\terrorElement.style.display = 'block';\n\t\t}\n\t}\n}\n\n/**\n * Validate entire form before submission\n * @param {HTMLFormElement} form\n * @returns {boolean} - True if all fields valid\n */\nexport function validateForm(form) {\n\tlet isValid = true;\n\tlet firstInvalidField = null;\n\n\t// Find all required fields\n\tconst requiredFields = form.querySelectorAll('.required_field:not([style*=\"display: none\"])');\n\n\trequiredFields.forEach(requiredWrap => {\n\t\t// Find fields to validate within this required wrapper\n\t\tconst fieldsToValidate = requiredWrap.querySelectorAll(\n\t\t\t'[field_type]:not([style*=\"display: none\"]), ' +\n\t\t\t'.geodir_select, ' +\n\t\t\t'.geodir_location_add_listing_chosen, ' +\n\t\t\t'.editor, ' +\n\t\t\t'.event_recurring_dates, ' +\n\t\t\t'.geodir-custom-file-upload, ' +\n\t\t\t'.gd_image_required_field, ' +\n\t\t\t'.g-recaptcha-response, ' +\n\t\t\t'[name=\"cf-turnstile-response\"]'\n\t\t);\n\n\t\tfieldsToValidate.forEach(field => {\n\t\t\tif (!validateField(field)) {\n\t\t\t\tisValid = false;\n\t\t\t\tif (!firstInvalidField) {\n\t\t\t\t\tfirstInvalidField = field;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\treturn isValid;\n}\n\n/**\n * Validate admin form (backend)\n * @param {HTMLFormElement} form\n * @returns {boolean}\n */\nexport function validateAdminForm(form) {\n\tlet isValid = true;\n\n\tconst requiredFields = form.querySelectorAll('.required_field:not([style*=\"display: none\"])');\n\n\trequiredFields.forEach(requiredWrap => {\n\t\tconst fieldsToValidate = requiredWrap.querySelectorAll(\n\t\t\t'[field_type]:not([style*=\"display: none\"]), ' +\n\t\t\t'.geodir_select, ' +\n\t\t\t'.geodir_location_add_listing_chosen, ' +\n\t\t\t'.editor, ' +\n\t\t\t'.event_recurring_dates, ' +\n\t\t\t'.geodir-custom-file-upload, ' +\n\t\t\t'.gd_image_required_field'\n\t\t);\n\n\t\tfieldsToValidate.forEach(field => {\n\t\t\tif (!validateField(field)) {\n\t\t\t\tisValid = false;\n\t\t\t}\n\t\t});\n\t});\n\n\tif (!isValid) {\n\t\t// Stop WordPress publish spinner\n\t\tconst saveSpinner = document.querySelector('#save-action .spinner');\n\t\tconst saveButton = document.querySelector('#save-action #save-post');\n\t\tconst publishSpinner = document.querySelector('#publishing-action .spinner');\n\t\tconst publishButton = document.querySelector('#publishing-action #publish');\n\n\t\tif (saveSpinner) saveSpinner.classList.remove('is-active');\n\t\tif (saveButton) saveButton.classList.remove('disabled');\n\t\tif (publishSpinner) publishSpinner.classList.remove('is-active');\n\t\tif (publishButton) publishButton.classList.remove('disabled');\n\t}\n\n\treturn isValid;\n}\n","/**\n * Utility functions for add-listing form\n */\n\n/**\n * Save all TinyMCE editors\n * Required before form serialization to capture latest editor content\n */\nexport function saveTinyMCEEditors() {\n\tif (typeof tinymce !== 'undefined' && tinymce.editors && tinymce.editors.length > 0) {\n\t\ttinymce.editors.forEach(editor => {\n\t\t\teditor.save();\n\t\t});\n\t}\n}\n\n/**\n * Check if localStorage is available\n * @returns {boolean}\n */\nexport function isLocalStorageAvailable() {\n\ttry {\n\t\tconst test = '__localStorage_test__';\n\t\tlocalStorage.setItem(test, test);\n\t\tlocalStorage.removeItem(test);\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\n/**\n * Get form data as URL-encoded string\n * @param {HTMLFormElement} form\n * @returns {string}\n */\nexport function getFormData(form) {\n\tsaveTinyMCEEditors();\n\tconst formData = new FormData(form);\n\treturn new URLSearchParams(formData).toString();\n}\n\n/**\n * Show Bootstrap toast notification\n * @param {string} message\n * @param {string} type - 'success', 'danger', 'warning', 'info'\n */\nexport function showToast(message, type = 'info') {\n\t// Check if Bootstrap Toast container exists, create if not\n\tlet toastContainer = document.querySelector('.toast-container');\n\tif (!toastContainer) {\n\t\ttoastContainer = document.createElement('div');\n\t\ttoastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';\n\t\tdocument.body.appendChild(toastContainer);\n\t}\n\n\t// Create toast element\n\tconst toastId = 'toast-' + Date.now();\n\tconst toastHTML = `\n\t\t<div id=\"${toastId}\" class=\"toast align-items-center text-bg-${type} border-0\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n\t\t\t<div class=\"d-flex\">\n\t\t\t\t<div class=\"toast-body\">${message}</div>\n\t\t\t\t<button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\n\t\t\t</div>\n\t\t</div>\n\t`;\n\n\ttoastContainer.insertAdjacentHTML('beforeend', toastHTML);\n\n\tconst toastElement = document.getElementById(toastId);\n\tconst toast = new bootstrap.Toast(toastElement, { autohide: true, delay: 3000 });\n\ttoast.show();\n\n\t// Remove toast element after it's hidden\n\ttoastElement.addEventListener('hidden.bs.toast', () => {\n\t\ttoastElement.remove();\n\t});\n}\n\n/**\n * Scroll to element with offset\n * @param {HTMLElement} element\n * @param {number} offset\n */\nexport function scrollToElement(element, offset = 100) {\n\tif (!element) return;\n\n\tconst elementPosition = element.getBoundingClientRect().top + window.pageYOffset;\n\tconst offsetPosition = elementPosition - offset;\n\n\twindow.scrollTo({\n\t\ttop: offsetPosition,\n\t\tbehavior: 'smooth'\n\t});\n}\n\n/**\n * Check if device supports touch\n * @returns {boolean}\n */\nexport function isTouchDevice() {\n\treturn ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0);\n}\n\n/**\n * Debounce function\n * @param {Function} func\n * @param {number} wait\n * @returns {Function}\n */\nexport function debounce(func, wait = 300) {\n\tlet timeout;\n\treturn function executedFunction(...args) {\n\t\tconst later = () => {\n\t\t\tclearTimeout(timeout);\n\t\t\tfunc(...args);\n\t\t};\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t};\n}\n\n/**\n * Get nested property value from object\n * @param {Object} obj\n * @param {string} path - e.g., 'data.user.name'\n * @returns {*}\n */\nexport function getNestedValue(obj, path) {\n\treturn path.split('.').reduce((current, prop) => current?.[prop], obj);\n}\n","/**\n * Auto-save functionality for add-listing form\n */\n\nimport { getFormData, isLocalStorageAvailable } from './utils.js';\n\n// Track if form has changes\nexport let hasChanges = false;\n\n// Track if currently uploading (don't auto-save during uploads)\nexport let isUploading = false;\n\n// Store previous form data for comparison\nlet previousFormData = '';\n\n// Auto-save interval ID\nlet autoSaveIntervalId = null;\n\n/**\n * Initialize auto-save functionality\n * @param {HTMLFormElement} form\n */\nexport function initAutoSave(form) {\n\tconst autosaveInterval = window.geodir_params?.autosave || 0;\n\n\tif (autosaveInterval <= 0) {\n\t\treturn; // Auto-save disabled\n\t}\n\n\t// Store initial form data\n\tpreviousFormData = getFormData(form);\n\n\t// Load saved user login/email from localStorage\n\tloadUserDataFromStorage(form);\n\n\t// Start polling for changes\n\tstartAutoSavePoll(form, autosaveInterval);\n\n\t// Set up beforeunload warning\n\tsetupBeforeUnloadWarning();\n}\n\n/**\n * Load user login/email from localStorage if available\n * @param {HTMLFormElement} form\n */\nfunction loadUserDataFromStorage(form) {\n\tif (!isLocalStorageAvailable()) return;\n\n\tconst userLoginField = form.querySelector('#user_login');\n\tconst userEmailField = form.querySelector('#user_email');\n\n\tif (userLoginField && localStorage.getItem('geodirUserLogin')) {\n\t\tuserLoginField.value = localStorage.getItem('geodirUserLogin');\n\t}\n\n\tif (userEmailField && localStorage.getItem('geodirUserEmail')) {\n\t\tuserEmailField.value = localStorage.getItem('geodirUserEmail');\n\t}\n}\n\n/**\n * Save user login/email to localStorage\n * @param {HTMLFormElement} form\n */\nfunction saveUserDataToStorage(form) {\n\tif (!isLocalStorageAvailable()) return;\n\n\tconst userLoginField = form.querySelector('#user_login');\n\tconst userEmailField = form.querySelector('#user_email');\n\n\tif (userLoginField && userLoginField.value) {\n\t\tlocalStorage.setItem('geodirUserLogin', userLoginField.value);\n\t}\n\n\tif (userEmailField && userEmailField.value) {\n\t\tlocalStorage.setItem('geodirUserEmail', userEmailField.value);\n\t}\n}\n\n/**\n * Clear user data from localStorage\n */\nexport function clearUserDataFromStorage() {\n\tif (!isLocalStorageAvailable()) return;\n\n\tlocalStorage.removeItem('geodirUserLogin');\n\tlocalStorage.removeItem('geodirUserEmail');\n}\n\n/**\n * Start auto-save polling\n * @param {HTMLFormElement} form\n * @param {number} interval - Interval in milliseconds\n */\nfunction startAutoSavePoll(form, interval) {\n\tautoSaveIntervalId = setInterval(() => {\n\t\tconst currentFormData = getFormData(form);\n\n\t\t// Only auto-save if form data has changed\n\t\tif (currentFormData !== previousFormData && !isUploading) {\n\t\t\tconsole.log('Form has changed, auto-saving...');\n\t\t\tperformAutoSave(form);\n\t\t\thasChanges = true;\n\t\t\tpreviousFormData = currentFormData;\n\t\t}\n\t}, interval);\n}\n\n/**\n * Stop auto-save polling\n */\nexport function stopAutoSave() {\n\tif (autoSaveIntervalId) {\n\t\tclearInterval(autoSaveIntervalId);\n\t\tautoSaveIntervalId = null;\n\t}\n}\n\n/**\n * Perform auto-save via AJAX\n * @param {HTMLFormElement} form\n */\nasync function performAutoSave(form) {\n\tif (isUploading) {\n\t\treturn;\n\t}\n\n\t// Save user data to localStorage\n\tsaveUserDataToStorage(form);\n\n\tconst formData = getFormData(form);\n\tconst params = formData + '&action=geodir_auto_save_post&target=auto';\n\n\ttry {\n\t\tconst response = await fetch(window.geodir_params.ajax_url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t\tbody: params\n\t\t});\n\n\t\tconst data = await response.json();\n\n\t\tif (data.success) {\n\t\t\tconsole.log('Auto-saved successfully');\n\t\t} else {\n\t\t\tconsole.log('Auto-save failed');\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('Auto-save error:', error);\n\t}\n}\n\n/**\n * Manually trigger auto-save (used by preview button, etc.)\n * @param {HTMLFormElement} form\n */\nexport function manualAutoSave(form) {\n\treturn performAutoSave(form);\n}\n\n/**\n * Set up beforeunload warning for unsaved changes\n */\nfunction setupBeforeUnloadWarning() {\n\twindow.addEventListener('beforeunload', (e) => {\n\t\tif (hasChanges) {\n\t\t\tconst message = window.geodir_params?.txt_lose_changes || 'You have unsaved changes. Are you sure you want to leave?';\n\t\t\te.preventDefault();\n\t\t\te.returnValue = message;\n\t\t\treturn message;\n\t\t}\n\t});\n}\n\n/**\n * Reset changes flag (called after successful form submission)\n */\nexport function resetChangesFlag() {\n\thasChanges = false;\n}\n\n/**\n * Set uploading flag\n * @param {boolean} uploading\n */\nexport function setUploading(uploading) {\n\tisUploading = uploading;\n}\n\n// Make uploading flag globally accessible (for legacy compatibility)\nif (typeof window !== 'undefined') {\n\twindow.geodirUploading = false;\n\n\t// Proxy to keep window.geodirUploading in sync\n\tObject.defineProperty(window, 'geodirUploading', {\n\t\tget() {\n\t\t\treturn isUploading;\n\t\t},\n\t\tset(value) {\n\t\t\tisUploading = value;\n\t\t}\n\t});\n}\n","/**\n * Form submission handling for add-listing form\n */\n\nimport { getFormData } from './utils.js';\nimport { validateForm } from './validation.js';\nimport { resetChangesFlag, clearUserDataFromStorage } from './auto-save.js';\n\n/**\n * Handle form submission\n * @param {Event} e - Submit event\n * @param {HTMLFormElement} form\n */\nexport async function handleFormSubmit(e, form) {\n\te.preventDefault();\n\n\t// Validate form\n\tif (!validateForm(form)) {\n\t\tscrollToFirstError(form);\n\t\treturn false;\n\t}\n\n\t// Submit the form\n\tawait submitForm(form);\n\treturn false;\n}\n\n/**\n * Submit form via AJAX\n * @param {HTMLFormElement} form\n */\nasync function submitForm(form) {\n\tconst formData = getFormData(form) + '&target=submit';\n\tconsole.log('Submitting form...');\n\n\tconst submitButton = form.querySelector('#geodir-add-listing-submit button');\n\tconst originalButtonText = submitButton ? submitButton.innerHTML : '';\n\n\ttry {\n\t\t// Show loading state\n\t\tif (submitButton) {\n\t\t\tsubmitButton.innerHTML = '<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span> ' + originalButtonText;\n\t\t\tsubmitButton.classList.add('gd-disabled');\n\t\t\tsubmitButton.disabled = true;\n\t\t}\n\n\t\t// Clear user data from localStorage\n\t\tclearUserDataFromStorage();\n\n\t\tconst response = await fetch(window.geodir_params.ajax_url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t\tbody: formData\n\t\t});\n\n\t\tconst data = await response.json();\n\n\t\tif (data.success) {\n\t\t\tconsole.log('Form submitted successfully');\n\t\t\tconsole.log(data.data);\n\n\t\t\t// Reset changes flag\n\t\t\tresetChangesFlag();\n\n\t\t\t// Remove current notifications\n\t\t\tdocument.querySelectorAll('.gd-notification').forEach(notif => notif.remove());\n\n\t\t\t// Get container to replace\n\t\t\tconst replaceContainerInput = document.querySelector('#gd-add-listing-replace-container');\n\t\t\tconst containerSelector = replaceContainerInput ? replaceContainerInput.value : '#geodirectory-add-post';\n\t\t\tconst containerToReplace = document.querySelector(containerSelector);\n\n\t\t\tif (containerToReplace && data.data) {\n\t\t\t\t// Replace container with response (success message or redirect)\n\t\t\t\tcontainerToReplace.outerHTML = data.data;\n\n\t\t\t\t// Scroll to notification\n\t\t\t\tconst notification = document.querySelector('.gd-notification');\n\t\t\t\tif (notification) {\n\t\t\t\t\tconst notificationTop = notification.getBoundingClientRect().top + window.pageYOffset - 100;\n\t\t\t\t\twindow.scrollTo({\n\t\t\t\t\t\ttop: notificationTop,\n\t\t\t\t\t\tbehavior: 'smooth'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t} else {\n\t\t\tconsole.log('Form submission failed');\n\n\t\t\t// Restore button state\n\t\t\tif (submitButton) {\n\t\t\t\tsubmitButton.innerHTML = originalButtonText;\n\t\t\t\tsubmitButton.classList.remove('gd-disabled');\n\t\t\t\tsubmitButton.disabled = false;\n\t\t\t}\n\n\t\t\t// Show error message\n\t\t\tif (data.data) {\n\t\t\t\talert(data.data);\n\t\t\t}\n\n\t\t\t// Dispatch event to reset captcha\n\t\t\tdocument.dispatchEvent(new Event('ayecode_reset_captcha'));\n\n\t\t\treturn false;\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('Form submission error:', error);\n\n\t\t// Restore button state\n\t\tif (submitButton) {\n\t\t\tsubmitButton.innerHTML = originalButtonText;\n\t\t\tsubmitButton.classList.remove('gd-disabled');\n\t\t\tsubmitButton.disabled = false;\n\t\t}\n\n\t\t// Show error message\n\t\tconst errorMsg = window.geodir_params?.rating_error_msg || 'An error occurred. Please try again.';\n\t\talert(errorMsg);\n\n\t\t// Dispatch event to reset captcha\n\t\tdocument.dispatchEvent(new Event('ayecode_reset_captcha'));\n\n\t\treturn false;\n\t}\n}\n\n/**\n * Delete revision via AJAX\n * @param {HTMLFormElement} form\n */\nexport async function deleteRevision(form) {\n\tconst formData = getFormData(form);\n\tconst params = formData + '&action=geodir_delete_revision&target=revision';\n\n\ttry {\n\t\tconst response = await fetch(window.geodir_params.ajax_url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t\tbody: params\n\t\t});\n\n\t\tconst data = await response.json();\n\n\t\tif (data.success) {\n\t\t\tconsole.log('Revision deleted successfully');\n\t\t\tlocation.reload();\n\t\t\treturn true;\n\t\t} else {\n\t\t\tconsole.log('Revision deletion failed');\n\t\t\tif (data.data) {\n\t\t\t\talert(data.data);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t} catch (error) {\n\t\tconsole.error('Revision deletion error:', error);\n\t\treturn false;\n\t}\n}\n\n/**\n * Scroll to first error message\n * @param {HTMLFormElement} form\n */\nfunction scrollToFirstError(form) {\n\t// Find first visible error\n\tconst firstError = form.querySelector('.geodir_message_error:not([style*=\"display: none\"])');\n\n\tif (firstError) {\n\t\tconst errorWrap = firstError.closest('.required_field');\n\t\tif (errorWrap) {\n\t\t\tconst errorTop = errorWrap.getBoundingClientRect().top + window.pageYOffset;\n\t\t\twindow.scrollTo({\n\t\t\t\ttop: errorTop,\n\t\t\t\tbehavior: 'smooth'\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// Fallback: find first invalid field\n\tconst firstInvalidField = form.querySelector('.is-invalid');\n\tif (firstInvalidField) {\n\t\tconst fieldTop = firstInvalidField.getBoundingClientRect().top + window.pageYOffset;\n\t\twindow.scrollTo({\n\t\t\ttop: fieldTop,\n\t\t\tbehavior: 'smooth'\n\t\t});\n\t}\n}\n","/**\n * Category management for add-listing form\n * Handles default category selection for checkboxes, radios, and selects\n */\n\n/**\n * Initialize category management\n * @param {HTMLFormElement} form\n */\nexport function initCategoryManager(form) {\n\t// Handle checkbox categories with default category\n\tinitCheckboxCategories(form);\n\n\t// Handle radio categories with default category\n\tinitRadioCategories(form);\n\n\t// Listen for category changes\n\tsetupCategoryChangeListeners(form);\n\n\t// Populate default category on load\n\tpopulateDefaultCategoryInput(form);\n}\n\n/**\n * Initialize checkbox category handling\n * @param {HTMLFormElement} form\n */\nfunction initCheckboxCategories(form) {\n\tconst checkboxes = form.querySelectorAll('.geodir_form_row input[data-ccheckbox]');\n\n\tcheckboxes.forEach(checkbox => {\n\t\tcheckbox.addEventListener('change', function(e) {\n\t\t\thandleCheckboxChange(this, form);\n\t\t});\n\t});\n\n\t// Handle \"make default\" buttons\n\tconst makeDefaultButtons = form.querySelectorAll('.gd-make-default-term');\n\tmakeDefaultButtons.forEach(button => {\n\t\tbutton.addEventListener('click', function(e) {\n\t\t\te.preventDefault();\n\t\t\thandleMakeDefaultClick(this, form);\n\t\t});\n\t});\n\n\t// Trigger initial change\n\tconst firstCheckbox = form.querySelector('.geodir_form_row input[data-ccheckbox]:first-of-type');\n\tif (firstCheckbox) {\n\t\tfirstCheckbox.dispatchEvent(new Event('change'));\n\t}\n}\n\n/**\n * Handle checkbox change event\n * @param {HTMLInputElement} checkbox\n * @param {HTMLFormElement} form\n */\nfunction handleCheckboxChange(checkbox, form) {\n\tconst parent = checkbox.closest('.geodir_form_row');\n\tconst fieldName = checkbox.dataset.ccheckbox;\n\tconst defaultCategoryField = form.querySelector(`input[name=\"${fieldName}\"]`);\n\n\tif (!parent || !defaultCategoryField) return;\n\n\t// Reset visual states\n\tparent.classList.remove('gd-term-handle');\n\tparent.querySelectorAll('.gd-term-checked').forEach(el => el.classList.remove('gd-term-checked'));\n\tparent.querySelectorAll('.gd-default-term').forEach(el => el.classList.remove('gd-default-term'));\n\n\tlet checkedCount = 0;\n\tlet firstCheckedInput = null;\n\tconst currentValue = defaultCategoryField.value || '';\n\n\t// Find all checked checkboxes\n\tconst name = checkbox.getAttribute('name');\n\tconst checkboxes = parent.querySelectorAll(`[name=\"${name}\"]`);\n\n\tcheckboxes.forEach(cb => {\n\t\tif (cb.checked) {\n\t\t\tcheckedCount++;\n\t\t\tcb.parentElement.classList.add('gd-term-checked');\n\n\t\t\tif (checkedCount === 1) {\n\t\t\t\tfirstCheckedInput = cb;\n\t\t\t}\n\t\t}\n\t});\n\n\t// If more than one checked, show \"make default\" options\n\tif (checkedCount > 1) {\n\t\tparent.classList.add('gd-term-handle');\n\t}\n\n\t// If current default value is still checked, keep it\n\tconst currentDefaultCheckbox = parent.querySelector(`#gd-cat-${currentValue}`);\n\tif (currentDefaultCheckbox && currentDefaultCheckbox.checked) {\n\t\tfirstCheckedInput = currentDefaultCheckbox;\n\t}\n\n\t// Set the default category\n\tif (firstCheckedInput) {\n\t\tconst makeDefaultButton = firstCheckedInput.parentElement.querySelector('.gd-make-default-term');\n\t\tif (makeDefaultButton) {\n\t\t\tmakeDefaultButton.click();\n\t\t}\n\t} else {\n\t\tdefaultCategoryField.value = '';\n\t\tdefaultCategoryField.dispatchEvent(new Event('change'));\n\t}\n}\n\n/**\n * Handle \"make default\" button click\n * @param {HTMLElement} button\n * @param {HTMLFormElement} form\n */\nfunction handleMakeDefaultClick(button, form) {\n\tconst row = button.closest('.geodir_form_row');\n\tconst parent = button.parentElement;\n\tconst checkbox = parent.querySelector('[type=\"checkbox\"]');\n\n\tif (!checkbox) return;\n\n\tconst fieldName = checkbox.dataset.ccheckbox;\n\tconst defaultCategoryField = form.querySelector(`input[name=\"${fieldName}\"]`);\n\n\tif (!defaultCategoryField) return;\n\n\t// Remove previous default\n\trow.querySelectorAll('.gd-default-term').forEach(el => el.classList.remove('gd-default-term'));\n\n\t// Set new default\n\tparent.classList.add('gd-default-term');\n\n\t// Update hidden field\n\tconst value = checkbox.value;\n\tdefaultCategoryField.value = value;\n\tdefaultCategoryField.dispatchEvent(new Event('change'));\n}\n\n/**\n * Initialize radio category handling\n * @param {HTMLFormElement} form\n */\nfunction initRadioCategories(form) {\n\tconst radios = form.querySelectorAll('.geodir_form_row input[data-cradio]');\n\n\tradios.forEach(radio => {\n\t\tradio.addEventListener('change', function() {\n\t\t\thandleRadioChange(this, form);\n\t\t});\n\t});\n\n\t// Trigger initial change\n\tconst firstRadio = form.querySelector('.geodir_form_row input[data-cradio]:first-of-type');\n\tif (firstRadio) {\n\t\tfirstRadio.dispatchEvent(new Event('change'));\n\t}\n}\n\n/**\n * Handle radio change event\n * @param {HTMLInputElement} radio\n * @param {HTMLFormElement} form\n */\nfunction handleRadioChange(radio, form) {\n\tconst fieldName = radio.dataset.cradio;\n\tconst defaultCategoryField = form.querySelector(`input[name=\"${fieldName}\"]`);\n\n\tif (!defaultCategoryField) return;\n\n\tlet value = '';\n\tconst name = radio.getAttribute('name');\n\tconst checkedRadio = form.querySelector(`[name=\"${name}\"]:checked`);\n\n\tif (checkedRadio) {\n\t\tvalue = checkedRadio.value;\n\t}\n\n\tdefaultCategoryField.value = value;\n}\n\n/**\n * Set up category change listeners\n * @param {HTMLFormElement} form\n */\nfunction setupCategoryChangeListeners(form) {\n\t// Listen for changes on category selects, checkboxes, and radios\n\tconst categoryFields = form.querySelectorAll(\n\t\t'.geodir_taxonomy_field .geodir-category-select, ' +\n\t\t'.geodir_taxonomy_field [data-ccheckbox=\"default_category\"], ' +\n\t\t'.geodir_taxonomy_field input[data-cradio]'\n\t);\n\n\tcategoryFields.forEach(field => {\n\t\tfield.addEventListener('change', () => {\n\t\t\tpopulateDefaultCategoryInput(form);\n\t\t\tconst defaultCategoryField = form.querySelector('[name=\"default_category\"]');\n\t\t\tif (defaultCategoryField) {\n\t\t\t\tdefaultCategoryField.dispatchEvent(new Event('change'));\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Populate the default_category hidden input based on selected categories\n * @param {HTMLFormElement} form\n */\nexport function populateDefaultCategoryInput(form) {\n\tconst defaultCategoryField = form.querySelector('#default_category');\n\tif (!defaultCategoryField) return;\n\n\tconst currentDefaultValue = defaultCategoryField.value;\n\n\t// Handle multi-select dropdown\n\tconst categorySelect = form.querySelector('.geodir_taxonomy_field .geodir-category-select');\n\tif (categorySelect) {\n\t\t// Clear options\n\t\tdefaultCategoryField.innerHTML = '';\n\n\t\tconst selectedValues = Array.from(categorySelect.selectedOptions).map(opt => opt.value);\n\n\t\tif (selectedValues.length > 0) {\n\t\t\tcategorySelect.querySelectorAll('option').forEach(option => {\n\t\t\t\tif (selectedValues.includes(option.value)) {\n\t\t\t\t\tconst newOption = document.createElement('option');\n\t\t\t\t\tnewOption.value = option.value;\n\t\t\t\t\tnewOption.textContent = option.textContent;\n\t\t\t\t\tnewOption.selected = currentDefaultValue === option.value ||\n\t\t\t\t\t                      (!currentDefaultValue && selectedValues[0] === option.value);\n\t\t\t\t\tdefaultCategoryField.appendChild(newOption);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tdefaultCategoryField.value = '';\n\t\t}\n\t\treturn;\n\t}\n\n\t// Handle checkboxes\n\tconst checkboxes = form.querySelectorAll('.geodir_taxonomy_field [data-ccheckbox=\"default_category\"]');\n\tif (checkboxes.length > 0) {\n\t\tdefaultCategoryField.innerHTML = '';\n\n\t\tconst selectedCheckboxes = Array.from(checkboxes).filter(cb => cb.checked);\n\n\t\tif (selectedCheckboxes.length > 0) {\n\t\t\tselectedCheckboxes.forEach((checkbox, index) => {\n\t\t\t\tconst newOption = document.createElement('option');\n\t\t\t\tnewOption.value = checkbox.value;\n\t\t\t\tnewOption.textContent = checkbox.title || checkbox.value;\n\t\t\t\tnewOption.selected = currentDefaultValue === checkbox.value ||\n\t\t\t\t                      (!currentDefaultValue && index === 0);\n\t\t\t\tdefaultCategoryField.appendChild(newOption);\n\t\t\t});\n\t\t} else {\n\t\t\tdefaultCategoryField.value = '';\n\t\t}\n\t\treturn;\n\t}\n\n\t// Handle radio buttons\n\tconst radios = form.querySelectorAll('.geodir_taxonomy_field [data-cradio=\"default_category\"]');\n\tif (radios.length > 0) {\n\t\tconst checkedRadio = form.querySelector('.geodir_taxonomy_field [data-cradio=\"default_category\"]:checked');\n\t\tif (checkedRadio) {\n\t\t\tdefaultCategoryField.value = checkedRadio.value;\n\t\t} else {\n\t\t\tdefaultCategoryField.value = '';\n\t\t}\n\t}\n}\n","/**\n * Business Hours Widget for add-listing form\n * Manages opening hours with time slots, timezones, and 24-hour mode\n */\n\n/**\n * Business Hours Manager Class\n */\nexport class BusinessHoursManager {\n\tconstructor(params) {\n\t\tthis.params = params;\n\t\tthis.field = params.field;\n\t\tthis.fieldElement = document.querySelector(`[name=\"${this.field}\"]`);\n\n\t\tif (!this.fieldElement) return;\n\n\t\tthis.wrap = this.fieldElement.closest('.gd-bh-row');\n\t\tif (!this.wrap) return;\n\n\t\tconst blankSlot = this.wrap.querySelector('.gd-bh-items .gd-bh-blank');\n\t\tthis.slotTemplate = blankSlot ? blankSlot.innerHTML : '';\n\n\t\tthis.defaultTimezoneString = window.geodir_params?.timezone_string || '';\n\t\tthis.defaultOffset = window.geodir_params?.gmt_offset || '0';\n\t\tthis.gmtOffset = params.offset || this.defaultOffset;\n\n\t\tthis.init();\n\t}\n\n\tinit() {\n\t\tthis.setupActiveToggle();\n\t\tthis.setupTimezoneChange();\n\t\tthis.setupAddSlot();\n\t\tthis.setup24HoursToggle();\n\n\t\t// Initialize existing slots after a short delay\n\t\tsetTimeout(() => {\n\t\t\tthis.initializeExistingSlots();\n\t\t\tthis.attachRemoveHandlers();\n\t\t\tthis.attachChangeHandlers();\n\t\t}, 100);\n\t}\n\n\tsetupActiveToggle() {\n\t\tconst activeToggle = this.wrap.querySelector('[data-field=\"active\"]');\n\t\tif (!activeToggle) return;\n\n\t\tactiveToggle.addEventListener('change', (e) => {\n\t\t\tconst itemsContainer = this.wrap.querySelector('.gd-bh-items');\n\n\t\t\tif (activeToggle.value === '1') {\n\t\t\t\tif (itemsContainer) {\n\t\t\t\t\titemsContainer.style.display = 'block';\n\t\t\t\t}\n\n\t\t\t\t// Reinitialize select2 if needed\n\t\t\t\tconst timezoneSelect = this.wrap.querySelector('[data-field=\"timezone_string\"]');\n\t\t\t\tif (timezoneSelect && timezoneSelect.classList.contains('select2-hidden-accessible')) {\n\t\t\t\t\t// Destroy and reinitialize select2 (if using select2)\n\t\t\t\t\t// For Choices.js, similar logic would apply\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (itemsContainer) {\n\t\t\t\t\titemsContainer.style.display = 'none';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setValue();\n\t\t\te.preventDefault();\n\t\t});\n\t}\n\n\tsetupTimezoneChange() {\n\t\tconst timezoneSelect = this.wrap.querySelector('[data-field=\"timezone_string\"]');\n\t\tif (!timezoneSelect) return;\n\n\t\ttimezoneSelect.addEventListener('change', (e) => {\n\t\t\tthis.setValue();\n\t\t\te.preventDefault();\n\t\t});\n\n\t\t// Auto-detect timezone when lat/lng changes\n\t\tconst form = this.wrap.closest('form');\n\t\tif (form) {\n\t\t\tconst latField = form.querySelector('[name=\"latitude\"]');\n\t\t\tconst lngField = form.querySelector('[name=\"longitude\"]');\n\n\t\t\tif (latField && lngField) {\n\t\t\t\t[latField, lngField].forEach(field => {\n\t\t\t\t\tfield.addEventListener('change', () => {\n\t\t\t\t\t\tif (!window.gdTzApi) {\n\t\t\t\t\t\t\twindow.gdTzApi = true;\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tthis.getTimezone(timezoneSelect);\n\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tsetupAddSlot() {\n\t\tconst addButtons = this.wrap.querySelectorAll('.gd-bh-add');\n\n\t\taddButtons.forEach(button => {\n\t\t\tbutton.addEventListener('click', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.addSlot(button);\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup24HoursToggle() {\n\t\tconst checkboxes = this.wrap.querySelectorAll('.gd-bh-24hours [type=\"checkbox\"]');\n\n\t\tcheckboxes.forEach(checkbox => {\n\t\t\tcheckbox.addEventListener('click', () => {\n\t\t\t\tthis.handle24HoursChange(checkbox);\n\t\t\t});\n\t\t});\n\t}\n\n\tinitializeExistingSlots() {\n\t\t// Handle existing 24-hour slots\n\t\tconst items24 = this.wrap.querySelectorAll('.gd-bh-has24');\n\t\titems24.forEach(item => {\n\t\t\tthis.handle24Hours(item.closest('.gd-bh-item'));\n\t\t});\n\n\t\t// Initialize change handlers for existing slots\n\t\tconst existingSlots = this.wrap.querySelectorAll('.gd-bh-hours');\n\t\tif (existingSlots.length > 0) {\n\t\t\tthis.attachChangeHandlers();\n\t\t}\n\t}\n\n\taddSlot(button) {\n\t\tconst item = button.closest('.gd-bh-item');\n\t\tif (!item) return;\n\n\t\tconst uniqueId = Math.floor(Math.random() * 100000000000).toString();\n\n\t\t// Remove \"closed\" message\n\t\titem.querySelectorAll('.gd-bh-closed').forEach(el => el.remove());\n\t\titem.classList.remove('gd-bh-item-closed');\n\n\t\t// Show 24-hour checkbox\n\t\tconst checkbox24 = item.querySelector('.gd-bh-24hours [type=\"checkbox\"]');\n\t\tif (checkbox24) {\n\t\t\tcheckbox24.style.display = '';\n\t\t}\n\n\t\t// Prepare slot HTML from template\n\t\tlet slotHTML = this.slotTemplate.replace(/GD_UNIQUE_ID/g, uniqueId);\n\n\t\tconst timeContainer = item.querySelector('.gd-bh-time');\n\t\tif (!timeContainer) return;\n\n\t\tconst fieldName = timeContainer.dataset.field;\n\n\t\tslotHTML = slotHTML.replace('data-field-alt=\"open\"',\n\t\t\t`data-field-alt=\"open\" name=\"${fieldName}[open][]\" data-aui-init=\"flatpickr\"`);\n\t\tslotHTML = slotHTML.replace('data-field-alt=\"close\"',\n\t\t\t`data-field-alt=\"close\" name=\"${fieldName}[close][]\" data-aui-init=\"flatpickr\"`);\n\n\t\ttimeContainer.insertAdjacentHTML('beforeend', slotHTML);\n\n\t\t// Reinitialize time pickers (if using AUI or other library)\n\t\tthis.initTimePickers();\n\n\t\t// Attach handlers to new slot\n\t\tthis.attachRemoveHandlers();\n\t\tthis.attachChangeHandlers();\n\t}\n\n\tremoveSlot(button) {\n\t\tconst hoursSlot = button.closest('.gd-bh-hours');\n\t\tif (!hoursSlot) return;\n\n\t\tconst timeContainer = hoursSlot.closest('.gd-bh-time');\n\t\tconst item = timeContainer.closest('.gd-bh-item');\n\n\t\t// Remove the slot\n\t\thoursSlot.remove();\n\n\t\t// Check if this was the last slot\n\t\tconst remainingSlots = timeContainer.querySelectorAll('.gd-bh-hours');\n\t\tif (remainingSlots.length === 0) {\n\t\t\titem.classList.add('gd-bh-item-closed');\n\n\t\t\t// Hide 24-hour checkbox\n\t\t\tconst checkbox24 = item.querySelector('.gd-bh-24hours [type=\"checkbox\"]');\n\t\t\tif (checkbox24) {\n\t\t\t\tcheckbox24.style.display = 'none';\n\t\t\t}\n\n\t\t\t// Show \"closed\" message\n\t\t\tconst closedText = window.geodir_params?.txt_closed || 'Closed';\n\t\t\ttimeContainer.innerHTML = `<div class=\"gd-bh-closed text-center\">${closedText}</div>`;\n\t\t}\n\n\t\tthis.setValue();\n\t}\n\n\tattachRemoveHandlers() {\n\t\tconst removeButtons = this.wrap.querySelectorAll('.gd-bh-remove');\n\n\t\tremoveButtons.forEach(button => {\n\t\t\t// Remove existing listener (if any) to avoid duplicates\n\t\t\tconst newButton = button.cloneNode(true);\n\t\t\tbutton.parentNode.replaceChild(newButton, button);\n\n\t\t\tnewButton.addEventListener('click', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.removeSlot(newButton);\n\t\t\t});\n\t\t});\n\t}\n\n\tattachChangeHandlers() {\n\t\tconst timeInputs = this.wrap.querySelectorAll(`[name^=\"${this.field}_f[hours]\"]`);\n\n\t\ttimeInputs.forEach(input => {\n\t\t\tconst newInput = input.cloneNode(true);\n\t\t\tinput.parentNode.replaceChild(newInput, input);\n\n\t\t\tnewInput.addEventListener('change', (e) => {\n\t\t\t\tconst item = newInput.closest('.gd-bh-item');\n\t\t\t\tthis.handle24Hours(item);\n\t\t\t\tthis.setValue();\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t});\n\t}\n\n\thandle24HoursChange(checkbox) {\n\t\tconst item = checkbox.closest('.gd-bh-item');\n\t\tconst hoursSlot = item.querySelector('.gd-bh-hours:first-of-type');\n\n\t\tif (!hoursSlot) return;\n\n\t\tif (checkbox.checked) {\n\t\t\tconst time12am = checkbox.closest('.gd-bh-items').dataset['12am']?.trim() || '12:00 AM';\n\n\t\t\titem.classList.add('gd-bh-item-24hours');\n\n\t\t\tconst inputGroups = item.querySelectorAll('.input-group');\n\t\t\tinputGroups.forEach(group => {\n\t\t\t\tgroup.style.opacity = '0.67';\n\t\t\t});\n\n\t\t\t// Set time to 00:00 (24 hours)\n\t\t\tconst openAlt = hoursSlot.querySelector('.gd-alt-open');\n\t\t\tconst closeAlt = hoursSlot.querySelector('.gd-alt-close');\n\t\t\tconst openField = hoursSlot.querySelector('[data-field-alt=\"open\"]');\n\t\t\tconst closeField = hoursSlot.querySelector('[data-field-alt=\"close\"]');\n\n\t\t\tif (openAlt) openAlt.value = time12am;\n\t\t\tif (closeAlt) closeAlt.value = time12am;\n\t\t\tif (openField) {\n\t\t\t\topenField.value = '00:00';\n\t\t\t\topenField.dispatchEvent(new Event('change'));\n\t\t\t}\n\t\t\tif (closeField) closeField.value = '00:00';\n\t\t} else {\n\t\t\tconst inputGroups = item.querySelectorAll('.input-group');\n\t\t\tinputGroups.forEach(group => {\n\t\t\t\tgroup.style.opacity = '1';\n\t\t\t});\n\t\t}\n\t}\n\n\thandle24Hours(item) {\n\t\tif (!item) return;\n\n\t\tlet has24 = false;\n\t\tconst hoursSlots = item.querySelectorAll('.gd-bh-hours');\n\n\t\thoursSlots.forEach(slot => {\n\t\t\tconst openField = slot.querySelector('[data-field-alt=\"open\"]');\n\t\t\tconst closeField = slot.querySelector('[data-field-alt=\"close\"]');\n\n\t\t\tif (openField && closeField) {\n\t\t\t\tconst openVal = openField.value.trim();\n\t\t\t\tconst closeVal = closeField.value.trim();\n\n\t\t\t\tif (openVal === '00:00' && closeVal === '00:00') {\n\t\t\t\t\thas24 = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst checkbox24 = item.querySelector('.gd-bh-24hours input[type=\"checkbox\"]');\n\t\tif (checkbox24) {\n\t\t\tcheckbox24.checked = has24;\n\t\t}\n\n\t\tif (has24) {\n\t\t\titem.classList.add('gd-bh-item-24hours');\n\t\t\tconst inputGroups = item.querySelectorAll('.input-group');\n\t\t\tinputGroups.forEach(group => {\n\t\t\t\tgroup.style.opacity = '0.67';\n\t\t\t});\n\t\t} else {\n\t\t\titem.classList.remove('gd-bh-item-24hours');\n\t\t\tconst inputGroups = item.querySelectorAll('.input-group');\n\t\t\tinputGroups.forEach(group => {\n\t\t\t\tgroup.style.opacity = '1';\n\t\t\t});\n\t\t}\n\t}\n\n\tsetValue() {\n\t\tconst activeRadio = this.wrap.querySelector(`[name=\"${this.field}_f_active\"]:checked`);\n\n\t\tlet value = '';\n\t\tif (activeRadio && activeRadio.value === '1') {\n\t\t\tvalue = this.toSchema();\n\t\t}\n\n\t\tthis.fieldElement.value = value;\n\t\tthis.fieldElement.dispatchEvent(new Event('change'));\n\t}\n\n\ttoSchema() {\n\t\tconst items = this.wrap.querySelectorAll('.gd-bh-item');\n\t\tconst daysArray = [];\n\n\t\titems.forEach(item => {\n\t\t\tconst timeContainer = item.querySelector('.gd-bh-time');\n\t\t\tif (!timeContainer) return;\n\n\t\t\tconst day = timeContainer.dataset.day;\n\t\t\tif (!day) return;\n\n\t\t\tconst hoursArray = [];\n\t\t\tconst hoursSlots = item.querySelectorAll('.gd-bh-hours');\n\n\t\t\thoursSlots.forEach(slot => {\n\t\t\t\tconst openField = slot.querySelector('[data-field-alt=\"open\"]');\n\t\t\t\tconst closeField = slot.querySelector('[data-field-alt=\"close\"]');\n\n\t\t\t\tif (openField) {\n\t\t\t\t\tconst openVal = openField.value.trim();\n\t\t\t\t\tlet closeVal = closeField ? closeField.value.trim() : '';\n\n\t\t\t\t\tif (openVal) {\n\t\t\t\t\t\tif (!closeVal) {\n\t\t\t\t\t\t\tcloseVal = '00:00';\n\t\t\t\t\t\t}\n\t\t\t\t\t\thoursArray.push(`${openVal}-${closeVal}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (hoursArray.length > 0) {\n\t\t\t\tdaysArray.push(`${day} ${hoursArray.join(',')}`);\n\t\t\t}\n\t\t});\n\n\t\tlet schema = '';\n\t\tif (daysArray.length > 0) {\n\t\t\tschema += JSON.stringify(daysArray);\n\t\t\tschema += ',';\n\t\t}\n\n\t\t// Add timezone info\n\t\tconst timezoneSelect = this.wrap.querySelector('[data-field=\"timezone_string\"]');\n\t\tlet tzString = this.defaultTimezoneString;\n\t\tlet tzOffset = this.defaultOffset;\n\n\t\tif (timezoneSelect) {\n\t\t\ttzString = timezoneSelect.value || tzString;\n\n\t\t\tconst selectedOption = timezoneSelect.querySelector('option:checked');\n\t\t\tif (selectedOption) {\n\t\t\t\ttzOffset = selectedOption.dataset.offset || tzOffset;\n\t\t\t}\n\t\t}\n\n\t\tschema += `[\"UTC\":\"${tzOffset}\",\"Timezone\":\"${tzString}\"]`;\n\n\t\treturn schema;\n\t}\n\n\tinitTimePickers() {\n\t\t// Trigger AUI initialization if available\n\t\tif (typeof window.aui_init === 'function') {\n\t\t\twindow.aui_init();\n\t\t}\n\t}\n\n\tasync getTimezone(selectElement, prefix = '') {\n\t\tconst form = selectElement.closest('form');\n\t\tif (!form) return;\n\n\t\tconst latField = form.querySelector(`[name=\"${prefix}latitude\"]`);\n\t\tconst lngField = form.querySelector(`[name=\"${prefix}longitude\"]`);\n\n\t\tif (!latField || !lngField) return;\n\n\t\tconst lat = latField.value.trim();\n\t\tconst lng = lngField.value.trim();\n\n\t\tif (!lat || !lng) return;\n\n\t\ttry {\n\t\t\tconst response = await fetch(window.geodir_params.gd_ajax_url, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t},\n\t\t\t\tbody: new URLSearchParams({\n\t\t\t\t\taction: 'geodir_timezone_data',\n\t\t\t\t\tsecurity: window.geodir_params.basic_nonce,\n\t\t\t\t\tlat: lat,\n\t\t\t\t\tlon: lng,\n\t\t\t\t\tts: Math.round(Date.now() / 1000).toString()\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tconst data = await response.json();\n\n\t\t\tif (data.success && data.data.timeZoneId) {\n\t\t\t\tselectElement.value = data.data.timeZoneId;\n\t\t\t\tselectElement.dispatchEvent(new Event('change'));\n\t\t\t} else if (data.data && data.data.error) {\n\t\t\t\tconsole.log(data.data.error);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Timezone fetch error:', error);\n\t\t} finally {\n\t\t\twindow.gdTzApi = false;\n\t\t}\n\t}\n}\n\n/**\n * Initialize business hours widgets on the page\n * @param {HTMLFormElement} form\n */\nexport function initBusinessHours(form) {\n\t// This would typically be called with parameters from PHP\n\t// For now, look for any business hours fields and initialize them\n\tconst bhRows = form.querySelectorAll('.gd-bh-row');\n\n\tbhRows.forEach(row => {\n\t\tconst hiddenField = row.querySelector('[name*=\"business_hours\"]');\n\t\tif (hiddenField) {\n\t\t\tconst fieldName = hiddenField.getAttribute('name');\n\t\t\t// Initialize with basic params (full params would come from PHP)\n\t\t\tnew BusinessHoursManager({\n\t\t\t\tfield: fieldName,\n\t\t\t\toffset: window.geodir_params?.gmt_offset || '0'\n\t\t\t});\n\t\t}\n\t});\n}\n","/**\n * Main initialization for add-listing form\n * Coordinates all modules and sets up event handlers\n */\n\nimport { validateField, validateForm, validateAdminForm } from './validation.js';\nimport { initAutoSave, manualAutoSave } from './auto-save.js';\nimport { handleFormSubmit, deleteRevision } from './form-submit.js';\nimport { initCategoryManager } from './category-manager.js';\nimport { initBusinessHours } from './business-hours.js';\nimport { scrollToElement } from './utils.js';\n\n/**\n * Initialize add-listing form\n */\nfunction initAddListingForm() {\n\t// Frontend form\n\tconst frontendForm = document.querySelector('#geodirectory-add-post');\n\tif (frontendForm) {\n\t\tsetupFrontendForm(frontendForm);\n\t}\n\n\t// Backend form (WordPress post edit screen)\n\tconst backendForm = document.querySelector('form#post .postbox#geodir_post_info');\n\tif (backendForm) {\n\t\tsetupBackendForm(backendForm);\n\t}\n}\n\n/**\n * Set up frontend add-listing form\n * @param {HTMLFormElement} form\n */\nfunction setupFrontendForm(form) {\n\tconsole.log('Initializing frontend add-listing form');\n\n\t// Initialize auto-save\n\tinitAutoSave(form);\n\n\t// Initialize category manager\n\tinitCategoryManager(form);\n\n\t// Initialize business hours widgets\n\tinitBusinessHours(form);\n\n\t// Set up field validation on blur\n\tsetupFieldValidation(form);\n\n\t// Set up form submission\n\tsetupFormSubmission(form);\n\n\t// Set up preview button\n\tsetupPreviewButton(form);\n\n\t// Set up conditional fields\n\tsetupConditionalFields(form);\n\n\t// Set up hidden lat/lng warning\n\tsetupLatLngWarning(form);\n\n\t// Set up geolocation button\n\tsetupGeolocation(form);\n\n\t// Set up post_tags spellcheck\n\tsetupTagsSpellcheck(form);\n}\n\n/**\n * Set up backend WordPress form validation\n * @param {HTMLElement} metabox\n */\nfunction setupBackendForm(metabox) {\n\tconsole.log('Initializing backend add-listing form');\n\n\tconst form = metabox.closest('form#post');\n\tif (!form) return;\n\n\t// Initialize category manager\n\tinitCategoryManager(form);\n\n\t// Initialize business hours widgets\n\tinitBusinessHours(form);\n\n\t// Set up field validation on blur\n\tsetupFieldValidation(form);\n\n\t// Intercept form submission\n\tform.addEventListener('submit', (e) => {\n\t\tif (!validateAdminForm(form)) {\n\t\t\te.preventDefault();\n\t\t\tscrollToFirstError(form);\n\t\t\treturn false;\n\t\t}\n\t});\n}\n\n/**\n * Set up field validation on blur/change events\n * @param {HTMLFormElement} form\n */\nfunction setupFieldValidation(form) {\n\t// Validation on blur for text inputs\n\tconst textFields = form.querySelectorAll('.required_field:not([style*=\"display: none\"]) [field_type]:not([style*=\"display: none\"]), .required_field:not([style*=\"display: none\"]) .editor textarea');\n\n\ttextFields.forEach(field => {\n\t\tfield.addEventListener('blur', function() {\n\t\t\t// Delay to allow other scripts to fill data\n\t\t\tsetTimeout(() => {\n\t\t\t\tvalidateField(this);\n\t\t\t}, 100);\n\t\t});\n\t});\n\n\t// Validation on click for checkboxes and radios\n\tconst clickFields = form.querySelectorAll('.required_field:not([style*=\"display: none\"]) input[type=\"checkbox\"], .required_field:not([style*=\"display: none\"]) input[type=\"radio\"]');\n\n\tclickFields.forEach(field => {\n\t\tfield.addEventListener('click', function() {\n\t\t\tvalidateField(this);\n\t\t});\n\t});\n\n\t// Validation on change for select/multiselect\n\tconst selectFields = form.querySelectorAll('.required_field:not([style*=\"display: none\"]) select.geodir-select');\n\n\tselectFields.forEach(field => {\n\t\tfield.addEventListener('change', function() {\n\t\t\tvalidateField(this);\n\t\t});\n\t});\n}\n\n/**\n * Set up form submission handler\n * @param {HTMLFormElement} form\n */\nfunction setupFormSubmission(form) {\n\tform.addEventListener('submit', async (e) => {\n\t\tawait handleFormSubmit(e, form);\n\t});\n}\n\n/**\n * Set up preview button\n * @param {HTMLFormElement} form\n */\nfunction setupPreviewButton(form) {\n\tconst previewButton = document.querySelector('.geodir_preview_button');\n\tif (!previewButton) return;\n\n\tpreviewButton.addEventListener('click', async () => {\n\t\t// Auto-save before preview\n\t\tawait manualAutoSave(form);\n\n\t\t// Validate form\n\t\treturn validateForm(form);\n\t});\n}\n\n/**\n * Set up conditional fields\n * @param {HTMLFormElement} form\n */\nfunction setupConditionalFields(form) {\n\t// Run conditional fields on change\n\tform.addEventListener('change', () => {\n\t\ttry {\n\t\t\tif (typeof window.aui_conditional_fields === 'function') {\n\t\t\t\twindow.aui_conditional_fields('#geodirectory-add-post,#post');\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.log('Conditional fields error:', err.message);\n\t\t}\n\t});\n\n\t// Run conditional fields on load\n\ttry {\n\t\tif (typeof window.aui_conditional_fields === 'function') {\n\t\t\twindow.aui_conditional_fields('#geodirectory-add-post,#post');\n\t\t}\n\t} catch (err) {\n\t\tconsole.log('Conditional fields error:', err.message);\n\t}\n}\n\n/**\n * Set up hidden lat/lng required field warning\n * @param {HTMLFormElement} form\n */\nfunction setupLatLngWarning(form) {\n\tconst hiddenLatLng = form.querySelector('.gd-hidden-latlng');\n\tif (!hiddenLatLng) return;\n\n\tconst submitButtons = form.querySelectorAll('[type=\"submit\"]');\n\n\tsubmitButtons.forEach(button => {\n\t\tbutton.addEventListener('click', () => {\n\t\t\tconst latField = form.querySelector('[name=\"latitude\"]');\n\t\t\tconst lngField = form.querySelector('[name=\"longitude\"]');\n\n\t\t\tif (latField && lngField) {\n\t\t\t\tconst lat = latField.value.trim();\n\t\t\t\tconst lng = lngField.value.trim();\n\n\t\t\t\tif (!lat || !lng) {\n\t\t\t\t\thiddenLatLng.classList.remove('d-none');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Set up geolocation \"locate me\" button\n * @param {HTMLFormElement} form\n */\nfunction setupGeolocation(form) {\n\tconst locateMeButtons = form.querySelectorAll('.gd-locate-me-btn');\n\n\tlocateMeButtons.forEach(button => {\n\t\tbutton.addEventListener('click', function() {\n\t\t\tif (typeof window.gdGeoLocateMe === 'function') {\n\t\t\t\twindow.gdGeoLocateMe(this, 'add-listing');\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Set up post_tags spellcheck\n * @param {HTMLFormElement} form\n */\nfunction setupTagsSpellcheck(form) {\n\tconst tagsSelect = form.querySelector('select#post_tags');\n\tif (!tagsSelect) return;\n\n\tif (tagsSelect.spellcheck) {\n\t\tsetTimeout(() => {\n\t\t\tconst tagsInput = form.querySelector('[data-argument=\"post_tags\"] input.select2-search__field');\n\t\t\tif (tagsInput) {\n\t\t\t\ttagsInput.spellcheck = true;\n\t\t\t}\n\t\t}, 5000);\n\t}\n}\n\n/**\n * Scroll to first error in form\n * @param {HTMLFormElement} form\n */\nfunction scrollToFirstError(form) {\n\tconst firstError = form.querySelector('.geodir_message_error:not([style*=\"display: none\"])');\n\n\tif (firstError) {\n\t\tconst errorWrap = firstError.closest('.required_field');\n\t\tif (errorWrap) {\n\t\t\tscrollToElement(errorWrap, 100);\n\t\t}\n\t}\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n\tdocument.addEventListener('DOMContentLoaded', initAddListingForm);\n} else {\n\tinitAddListingForm();\n}\n\n// Make some functions globally accessible for legacy compatibility\nif (typeof window !== 'undefined') {\n\twindow.geodir_validate_field = validateField;\n\twindow.geodir_validate_submit = validateForm;\n\twindow.geodir_validate_admin_submit = (form) => validateAdminForm(form);\n\twindow.geodir_delete_revision = () => {\n\t\tconst form = document.querySelector('#geodirectory-add-post') || document.querySelector('form#post');\n\t\tif (form) {\n\t\t\tdeleteRevision(form);\n\t\t}\n\t};\n}\n"],"names":["validateField","field","fieldType","isValid","errorMessage","requiredFieldWrap","checkedInputs","catLimitInput","catLimit","catMsg","selectedOption","multiCatLimit","limit","msg","selectedOptions","emailRegex","urlRegex","fieldId","editorField","updateFieldValidationUI","errorElement","validateForm","form","requiredWrap","validateAdminForm","saveSpinner","saveButton","publishSpinner","publishButton","saveTinyMCEEditors","editor","isLocalStorageAvailable","test","getFormData","formData","scrollToElement","element","offset","offsetPosition","hasChanges","isUploading","previousFormData","initAutoSave","autosaveInterval","loadUserDataFromStorage","startAutoSavePoll","setupBeforeUnloadWarning","userLoginField","userEmailField","saveUserDataToStorage","clearUserDataFromStorage","interval","currentFormData","performAutoSave","params","error","manualAutoSave","message","resetChangesFlag","value","handleFormSubmit","submitForm","scrollToFirstError","submitButton","originalButtonText","data","notif","replaceContainerInput","containerSelector","containerToReplace","notification","notificationTop","errorMsg","deleteRevision","firstError","errorWrap","errorTop","firstInvalidField","fieldTop","initCategoryManager","initCheckboxCategories","initRadioCategories","setupCategoryChangeListeners","populateDefaultCategoryInput","checkbox","e","handleCheckboxChange","button","handleMakeDefaultClick","firstCheckbox","parent","fieldName","defaultCategoryField","el","checkedCount","firstCheckedInput","currentValue","name","cb","currentDefaultCheckbox","makeDefaultButton","row","radio","handleRadioChange","firstRadio","checkedRadio","currentDefaultValue","categorySelect","selectedValues","opt","option","newOption","checkboxes","selectedCheckboxes","index","BusinessHoursManager","blankSlot","activeToggle","itemsContainer","timezoneSelect","latField","lngField","item","uniqueId","checkbox24","slotHTML","timeContainer","hoursSlot","closedText","newButton","input","newInput","time12am","group","openAlt","closeAlt","openField","closeField","has24","slot","openVal","closeVal","activeRadio","items","daysArray","day","hoursArray","schema","tzString","tzOffset","selectElement","prefix","lat","lng","initBusinessHours","hiddenField","initAddListingForm","frontendForm","setupFrontendForm","backendForm","setupBackendForm","setupFieldValidation","setupFormSubmission","setupPreviewButton","setupConditionalFields","setupLatLngWarning","setupGeolocation","setupTagsSpellcheck","metabox","previewButton","err","hiddenLatLng","tagsSelect","tagsInput"],"mappings":"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"}