(function(){var v,L,P,_,S,A={}.hasOwnProperty,F=[].slice;this.OverlappingMarkerSpiderfier=(function(){function m(t,r){var e,n,i;this.map=t,r==null&&(r={}),this.constructor.N==null&&(this.constructor.N=!0,f=google.maps,a=f.event,d=f.MapTypeId,o.keepSpiderfied=!1,o.ignoreMapClick=!1,o.markersWontHide=!1,o.markersWontMove=!1,o.basicFormatEvents=!1,o.nearbyDistance=20,o.circleSpiralSwitchover=9,o.circleFootSeparation=23,o.circleStartAngle=E/12,o.spiralFootSeparation=26,o.spiralLengthStart=11,o.spiralLengthFactor=4,o.spiderfiedZIndex=f.Marker.MAX_ZINDEX+2e4,o.highlightedLegZIndex=f.Marker.MAX_ZINDEX+1e4,o.usualLegZIndex=f.Marker.MAX_ZINDEX+1,o.legWeight=1.5,o.legColors={usual:{},highlighted:{}},i=o.legColors.usual,n=o.legColors.highlighted,i[d.HYBRID]=i[d.SATELLITE]="#fff",n[d.HYBRID]=n[d.SATELLITE]="#f00",i[d.TERRAIN]=i[d.ROADMAP]="#444",n[d.TERRAIN]=n[d.ROADMAP]="#f00",this.constructor.j=function(s){return this.setMap(s)},this.constructor.j.prototype=new f.OverlayView,this.constructor.j.prototype.draw=function(){});for(e in r)A.call(r,e)&&(n=r[e],this[e]=n);this.g=new this.constructor.j(this.map),this.C(),this.c={},this.B=this.l=null,this.addListener("click",function(s,u){return a.trigger(s,"spider_click",u)}),this.addListener("format",function(s,u){return a.trigger(s,"spider_format",u)}),this.ignoreMapClick||a.addListener(this.map,"click",(function(s){return function(){return s.unspiderfy()}})(this)),a.addListener(this.map,"maptypeid_changed",(function(s){return function(){return s.unspiderfy()}})(this)),a.addListener(this.map,"zoom_changed",(function(s){return function(){if(s.unspiderfy(),!s.basicFormatEvents)return s.h()}})(this))}var a,f,k,b,d,o,y,E,w;for(o=m.prototype,y=[m,o],k=0,b=y.length;k<b;k++)w=y[k],w.VERSION="1.0.1";return E=2*Math.PI,f=a=d=null,m.markerStatus={SPIDERFIED:"SPIDERFIED",SPIDERFIABLE:"SPIDERFIABLE",UNSPIDERFIABLE:"UNSPIDERFIABLE",UNSPIDERFIED:"UNSPIDERFIED"},o.C=function(){this.a=[],this.s=[]},o.addMarker=function(t,r){return t.setMap(this.map),this.trackMarker(t,r)},o.trackMarker=function(t,r){var e;return t._oms!=null?this:(t._oms=!0,e=[a.addListener(t,"click",(function(n){return function(i){return n.V(t,i)}})(this))],this.markersWontHide||e.push(a.addListener(t,"visible_changed",(function(n){return function(){return n.D(t,!1)}})(this))),this.markersWontMove||e.push(a.addListener(t,"position_changed",(function(n){return function(){return n.D(t,!0)}})(this))),r!=null&&e.push(a.addListener(t,"spider_click",r)),this.s.push(e),this.a.push(t),this.basicFormatEvents?this.trigger("format",t,this.constructor.markerStatus.UNSPIDERFIED):this.h(),this)},o.D=function(t,r){if(!this.J&&!this.K)return t._omsData==null||!r&&t.getVisible()||this.unspiderfy(r?t:null),this.h()},o.getMarkers=function(){return this.a.slice(0)},o.removeMarker=function(t){return this.forgetMarker(t),t.setMap(null)},o.forgetMarker=function(t){var r,e,n,i,s;if(t._omsData!=null&&this.unspiderfy(),r=this.A(this.a,t),0>r)return this;for(s=this.s.splice(r,1)[0],e=0,n=s.length;e<n;e++)i=s[e],a.removeListener(i);return delete t._oms,this.a.splice(r,1),this.h(),this},o.removeAllMarkers=o.clearMarkers=function(){var t,r,e,n;for(n=this.getMarkers(),this[forgetAllMarkers](),t=0,r=n.length;t<r;t++)e=n[t],e.setMap(null);return this},o.forgetAllMarkers=function(){var t,r,e,n,i,s,u,h;for(this.unspiderfy(),h=this.a,t=r=0,e=h.length;r<e;t=++r){for(s=h[t],i=this.s[t],u=0,t=i.length;u<t;u++)n=i[u],a.removeListener(n);delete s._oms}return this.C(),this},o.addListener=function(t,r){var e;return((e=this.c)[t]!=null?e[t]:e[t]=[]).push(r),this},o.removeListener=function(t,r){var e;return e=this.A(this.c[t],r),0>e||this.c[t].splice(e,1),this},o.clearListeners=function(t){return this.c[t]=[],this},o.trigger=function(){var t,r,e,n,i,s;for(r=arguments[0],t=2<=arguments.length?F.call(arguments,1):[],r=(e=this.c[r])!=null?e:[],s=[],n=0,i=r.length;n<i;n++)e=r[n],s.push(e.apply(null,t));return s},o.L=function(t,r){var e,n,i,s,u;for(s=this.circleFootSeparation*(2+t)/E,n=E/t,u=[],e=i=0;0<=t?i<t:i>t;e=0<=t?++i:--i)e=this.circleStartAngle+e*n,u.push(new f.Point(r.x+s*Math.cos(e),r.y+s*Math.sin(e)));return u},o.M=function(t,r){var e,n,i,s,u;for(s=this.spiralLengthStart,e=0,u=[],n=i=0;0<=t?i<t:i>t;n=0<=t?++i:--i)e+=this.spiralFootSeparation/s+5e-4*n,n=new f.Point(r.x+s*Math.cos(e),r.y+s*Math.sin(e)),s+=E*this.spiralLengthFactor/e,u.push(n);return u},o.V=function(t,r){var e,n,i,s,u,h,l,c,g;if((h=t._omsData!=null)&&this.keepSpiderfied||this.unspiderfy(),h||this.map.getStreetView().getVisible()||this.map.getMapTypeId()==="GoogleEarthAPI")return this.trigger("click",t,r);for(h=[],l=[],e=this.nearbyDistance,c=e*e,u=this.f(t.position),g=this.a,e=0,n=g.length;e<n;e++)i=g[e],i.map!=null&&i.getVisible()&&(s=this.f(i.position),this.i(s,u)<c?h.push({R:i,G:s}):l.push(i));return h.length===1?this.trigger("click",t,r):this.W(h,l)},o.markersNearMarker=function(t,r){var e,n,i,s,u,h,l,c,g,p;if(r==null&&(r=!1),this.g.getProjection()==null)throw"Must wait for 'idle' event on map before calling markersNearMarker";for(e=this.nearbyDistance,l=e*e,u=this.f(t.position),h=[],c=this.a,e=0,n=c.length;e<n&&(i=c[e],!(i!==t&&i.map!=null&&i.getVisible()&&(s=this.f((g=(p=i._omsData)!=null?p.v:void 0)!=null?g:i.position),this.i(s,u)<l&&(h.push(i),r))));e++);return h},o.F=function(){var t,r,e,n,i,s,u,h,l,c,g;if(this.g.getProjection()==null)throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";l=this.nearbyDistance,l*=l;var p;for(i=this.a,p=[],c=0,r=i.length;c<r;c++)n=i[c],p.push({H:this.f((t=(e=n._omsData)!=null?e.v:void 0)!=null?t:n.position),b:!1});for(c=this.a,t=e=0,n=c.length;e<n;t=++e)if(r=c[t],r.getMap()!=null&&r.getVisible()&&(s=p[t],!s.b)){for(g=this.a,r=h=0,i=g.length;h<i;r=++h)if(u=g[r],r!==t&&u.getMap()!=null&&u.getVisible()&&(u=p[r],(!(r<t)||u.b)&&this.i(s.H,u.H)<l)){s.b=u.b=!0;break}}return p},o.markersNearAnyOtherMarker=function(){var t,r,e,n,i,s,u;for(i=this.F(),s=this.a,u=[],t=r=0,e=s.length;r<e;t=++r)n=s[t],i[t].b&&u.push(n);return u},o.setImmediate=function(t){return window.setTimeout(t,0)},o.h=function(){if(!this.basicFormatEvents&&this.l==null)return this.l=this.setImmediate((function(t){return function(){return t.l=null,t.g.getProjection()!=null?t.w():t.B!=null?void 0:t.B=a.addListenerOnce(t.map,"idle",function(){return t.w()})}})(this))},o.w=function(){var t,r,e,n,i,s,u;if(this.basicFormatEvents){for(i=[],r=0,e=markers.length;r<e;r++)n=markers[r],t=n._omsData!=null?"SPIDERFIED":"UNSPIDERFIED",i.push(this.trigger("format",n,this.constructor.markerStatus[t]));return i}for(i=this.F(),s=this.a,u=[],t=e=0,r=s.length;e<r;t=++e)n=s[t],t=n._omsData!=null?"SPIDERFIED":i[t].b?"SPIDERFIABLE":"UNSPIDERFIABLE",u.push(this.trigger("format",n,this.constructor.markerStatus[t]));return u},o.P=function(t){return{m:(function(r){return function(){return t._omsData.o.setOptions({strokeColor:r.legColors.highlighted[r.map.mapTypeId],zIndex:r.highlightedLegZIndex})}})(this),u:(function(r){return function(){return t._omsData.o.setOptions({strokeColor:r.legColors.usual[r.map.mapTypeId],zIndex:r.usualLegZIndex})}})(this)}},o.W=function(t,r){var e,n,i,s,u,h,l,c,g,p;return this.J=!0,p=t.length,e=this.T((function(){var I,M,D;for(D=[],I=0,M=t.length;I<M;I++)c=t[I],D.push(c.G);return D})()),s=p>=this.circleSpiralSwitchover?this.M(p,e).reverse():this.L(p,e),e=(function(){var I,M,D;for(D=[],I=0,M=s.length;I<M;I++)i=s[I],n=this.U(i),g=this.S(t,(function(R){return function(x){return R.i(x.G,i)}})(this)),l=g.R,h=new f.Polyline({map:this.map,path:[l.position,n],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),l._omsData={v:l.position,o:h},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(u=this.P(l),l._omsData.O={m:a.addListener(l,"mouseover",u.m),u:a.addListener(l,"mouseout",u.u)}),this.trigger("format",l,this.constructor.markerStatus.SPIDERFIED),l.setPosition(n),l.setZIndex(Math.round(this.spiderfiedZIndex+i.y)),D.push(l);return D}).call(this),delete this.J,this.I=!0,this.trigger("spiderfy",e,r)},o.unspiderfy=function(t){var r,e,n,i,s,u,h;if(t==null&&(t=null),this.I==null)return this;for(this.K=!0,h=[],s=[],u=this.a,r=0,e=u.length;r<e;r++)i=u[r],i._omsData!=null?(i._omsData.o.setMap(null),i!==t&&i.setPosition(i._omsData.v),i.setZIndex(null),n=i._omsData.O,n!=null&&(a.removeListener(n.m),a.removeListener(n.u)),delete i._omsData,i!==t&&(n=this.basicFormatEvents?"UNSPIDERFIED":"SPIDERFIABLE",this.trigger("format",i,this.constructor.markerStatus[n])),h.push(i)):s.push(i);return delete this.K,delete this.I,this.trigger("unspiderfy",h,s),this},o.i=function(t,r){var e,n;return e=t.x-r.x,n=t.y-r.y,e*e+n*n},o.T=function(t){var r,e,n,i,s;for(r=i=s=0,e=t.length;r<e;r++)n=t[r],i+=n.x,s+=n.y;return t=t.length,new f.Point(i/t,s/t)},o.f=function(t){return this.g.getProjection().fromLatLngToDivPixel(t)},o.U=function(t){return this.g.getProjection().fromDivPixelToLatLng(t)},o.S=function(t,r){var e,n,i,s,u,h;for(i=u=0,h=t.length;u<h;i=++u)s=t[i],s=r(s),(typeof e>"u"||e===null||s<n)&&(n=s,e=i);return t.splice(e,1)[0]},o.A=function(t,r){var e,n,i,s;if(t.indexOf!=null)return t.indexOf(r);for(e=n=0,i=t.length;n<i;e=++n)if(s=t[e],s===r)return e;return-1},m})(),L=/(\?.*(&|&amp;)|\?)spiderfier_callback=(\w+)/,v=document.currentScript,v==null&&(v=(function(){var m,a,f,k,b;for(f=document.getElementsByTagName("script"),b=[],m=0,a=f.length;m<a;m++)S=f[m],(k=S.getAttribute("src"))!=null&&k.match(L)&&b.push(S);return b})()[0]),v!=null&&(v=(P=v.getAttribute("src"))!=null&&(_=P.match(L))!=null?_[3]:void 0)&&typeof window[v]=="function"&&window[v](),typeof window.spiderfier_callback=="function"&&window.spiderfier_callback()}).call(void 0);
//# sourceMappingURL=oms.js.map
